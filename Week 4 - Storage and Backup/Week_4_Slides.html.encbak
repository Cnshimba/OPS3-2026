
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Week 4 Slides</title>

<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                },
                colors: {
                    primary: '#002F6E', // VUT Midnight Blue
                    secondary: '#6c757d',
                    codebg: 'var(--bg-code)', 
                },
                typography: {
                    DEFAULT: {
                        css: {
                            maxWidth: '100%',
                            fontFamily: 'Inter, sans-serif',
                            color: 'var(--text-body)',
                            '--tw-prose-body': 'var(--text-body)',
                            '--tw-prose-headings': 'var(--text-headings)',
                            '--tw-prose-links': 'var(--text-link)',
                            '--tw-prose-bold': 'var(--text-headings)',
                            '--tw-prose-counters': 'var(--text-body)',
                            '--tw-prose-bullets': 'var(--text-body)',
                            '--tw-prose-hr': 'var(--border-color)',
                            '--tw-prose-quotes': 'var(--text-body)',
                            '--tw-prose-code': 'var(--text-code)',
                            '--tw-prose-pre-code': 'var(--text-pre)',
                            '--tw-prose-pre-bg': 'var(--bg-pre)',
                            
                            // Image Sizing Control
                            img: {
                                display: 'block',
                                marginLeft: 'auto',
                                marginRight: 'auto',
                                maxHeight: '500px',
                                width: 'auto',
                                height: 'auto',
                                borderRadius: '0.5rem',
                                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                            },
                            // Links
                            a: {
                                color: 'var(--text-link)',
                                '&:hover': { opacity: '0.8' },
                            },
                            // Inline Code
                            code: {
                                color: 'var(--text-code)',
                                backgroundColor: 'var(--bg-code)',
                                padding: '0.2rem 0.4rem',
                                borderRadius: '0.25rem',
                                fontWeight: '600',
                                border: '1px solid var(--border-code)',
                            },
                            'code::before': { content: '""' },
                            'code::after': { content: '""' },
                            // Code Blocks (Pre)
                            pre: {
                                backgroundColor: 'var(--bg-pre) !important',
                                color: 'var(--text-pre)',
                                padding: '1rem',
                                borderRadius: '0.5rem',
                                border: '1px solid var(--border-pre)',
                            },
                            // Notes/Alerts (Blockquotes)
                            blockquote: {
                                borderLeftColor: '#002F6E',
                                borderLeftWidth: '4px',
                                backgroundColor: 'var(--bg-note)',
                                padding: '1rem',
                                color: 'var(--text-body)',
                                fontSize: '0.9rem', // Smaller text for notes
                                fontStyle: 'italic',
                                quotes: 'none',
                                borderRadius: '0 0.5rem 0.5rem 0',
                            },
                            'blockquote p:first-of-type::before': { content: 'none' },
                            'blockquote p:last-of-type::after': { content: 'none' },
                            // Tables (Restored from First Attempt)
                            table: {
                                width: '100%',
                                marginTop: '2em',
                                marginBottom: '2em',
                                borderCollapse: 'collapse',
                                fontSize: '0.9rem',
                            },
                            'thead th': {
                                backgroundColor: '#f3f4f6', 
                                color: '#1f2937', 
                                fontWeight: '600',
                                padding: '0.75rem',
                                borderBottom: '2px solid #e5e7eb',
                                textAlign: 'left',
                            },
                            'tbody td': {
                                padding: '0.75rem',
                                borderBottom: '1px solid #e5e7eb',
                                verticalAlign: 'top',
                            },
                            'tbody tr:hover': {
                                backgroundColor: '#f9fafb',
                            },
                            
                            // Task Lists (Checkboxes)
                            '.task-list-item': {
                                listStyleType: 'none',
                            },
                            '.task-list-item input[type="checkbox"]': {
                                marginRight: '0.5rem',
                            },

                            thead: {
                                borderBottomWidth: '2px',
                                borderBottomColor: 'var(--border-color)',
                            },
                            'thead th': {
                                color: 'var(--text-headings)',
                                fontWeight: '600',
                                verticalAlign: 'bottom',
                                paddingRight: '0.75em',
                                paddingBottom: '0.75em',
                                paddingLeft: '0.75em',
                                textAlign: 'left',
                            },
                            'tbody tr': {
                                borderBottomWidth: '1px',
                                borderBottomColor: 'var(--border-color)',
                            },
                            'tbody tr:last-child': {
                                borderBottomWidth: '0',
                            },
                            'tbody td': {
                                verticalAlign: 'top',
                                padding: '0.75em',
                            },
                        },
                    },
                },
            },
        },
    }
</script>
<script>
    // Theme Toggle Logic
    document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const iconSun = document.getElementById('icon-sun');
        const iconMoon = document.getElementById('icon-moon');

        // Check local storage or preference
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
            iconSun.classList.remove('hidden');
            iconMoon.classList.add('hidden');
        } else {
            html.classList.remove('dark');
            iconSun.classList.add('hidden');
            iconMoon.classList.remove('hidden');
        }

        themeToggle.addEventListener('click', () => {
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.theme = 'light';
                iconSun.classList.add('hidden');
                iconMoon.classList.remove('hidden');
            } else {
                html.classList.add('dark');
                localStorage.theme = 'dark';
                iconSun.classList.remove('hidden');
                iconMoon.classList.add('hidden');
            }
        });
    });
</script>
<style>
    /* CSS Variables for Theming */
    :root {
        --bg-body: #f8fafc;
        --bg-card: #ffffff;
        --text-body: #334155;
        --text-headings: #0f172a;
        --text-link: #002F6E; /* VUT Blue */
        --border-color: #e2e8f0;
        
        /* Code - Light Mode */
        --bg-code: #f1f5f9;
        --text-code: #d63384;
        --border-code: #e2e8f0;
        
        /* Pre - Light Mode (Github Light) */
        --bg-pre: #f6f8fa;
        --text-pre: #24292e;
        --border-pre: #d0d7de;
        
        /* Note - Light Mode */
        --bg-note: #f8f9fa;
        
        /* Scrollbar */
        --scroll-track: #f1f1f1;
        --scroll-thumb: #888;
    }

    html.dark {
        --bg-body: #0f172a;
        --bg-card: #1e293b;
        --text-body: #cbd5e1;
        --text-headings: #f8fafc;
        --text-link: #60a5fa; /* Blue 400 - Brighter for better contrast */
        --border-color: #334155;
        
        /* Code - Dark Mode */
        --bg-code: #334155;
        --text-code: #f472b6; 
        --border-code: #475569;
        
        /* Pre - Dark Mode (Monokai) */
        --bg-pre: #272822;
        --text-pre: #f8f8f2;
        --border-pre: #464539;
        
        /* Note - Dark Mode */
        --bg-note: #1e293b;
        --scroll-track: #1e293b;
        --scroll-thumb: #475569;
    }

    /* Transition */
    body, article, code, pre, blockquote {
        transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--scroll-track); }
    ::-webkit-scrollbar-thumb { background: var(--scroll-thumb); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
    
    /* Syntax Highlighting - LIGHT MODE (GitHub Light Inspired) */
    .codehilite .hll { background-color: #ffffcc }
    .codehilite .c { color: #6a737d; font-style: italic } /* Comment */
    .codehilite .err { color: #f05240; background-color: #ffeaea } /* Error */
    .codehilite .k { color: #d73a49; font-weight: bold } /* Keyword */
    .codehilite .o { color: #d73a49; font-weight: bold } /* Operator */
    .codehilite .cm { color: #6a737d; font-style: italic } /* Comment.Multiline */
    .codehilite .cp { color: #6a737d; font-weight: bold } /* Comment.Preproc */
    .codehilite .c1 { color: #6a737d; font-style: italic } /* Comment.Single */
    .codehilite .cs { color: #6a737d; font-style: italic } /* Comment.Special */
    .codehilite .gd { color: #d73a49; background-color: #fdd } /* Generic.Deleted */
    .codehilite .ge { font-style: italic } /* Generic.Emph */
    .codehilite .gr { color: #aa0000 } /* Generic.Error */
    .codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
    .codehilite .gi { color: #00a000; background-color: #dfd } /* Generic.Inserted */
    .codehilite .go { color: #888888 } /* Generic.Output */
    .codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
    .codehilite .gs { font-weight: bold } /* Generic.Strong */
    .codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
    .codehilite .gt { color: #aa0000 } /* Generic.Traceback */
    .codehilite .kc { color: #005cc5; font-weight: bold } /* Keyword.Constant */
    .codehilite .kd { color: #d73a49; font-weight: bold } /* Keyword.Declaration */
    .codehilite .kn { color: #d73a49; font-weight: bold } /* Keyword.Namespace */
    .codehilite .kp { color: #d73a49 } /* Keyword.Pseudo */
    .codehilite .kr { color: #d73a49; font-weight: bold } /* Keyword.Reserved */
    .codehilite .kt { color: #445588; font-weight: bold } /* Keyword.Type */
    .codehilite .m { color: #005cc5 } /* Literal.Number */
    .codehilite .s { color: #032f62 } /* Literal.String */
    .codehilite .na { color: #22863a } /* Name.Attribute */
    .codehilite .nb { color: #005cc5 } /* Name.Builtin */
    .codehilite .nc { color: #6f42c1; font-weight: bold } /* Name.Class */
    .codehilite .no { color: #005cc5 } /* Name.Constant */
    .codehilite .nd { color: #6f42c1; font-weight: bold } /* Name.Decorator */
    .codehilite .ni { color: #800080 } /* Name.Entity */
    .codehilite .ne { color: #990000; font-weight: bold } /* Name.Exception */
    .codehilite .nf { color: #6f42c1; font-weight: bold } /* Name.Function */
    .codehilite .nl { color: #990000; font-weight: bold } /* Name.Label */
    .codehilite .nn { color: #6f42c1; font-weight: bold } /* Name.Namespace */
    .codehilite .nt { color: #22863a } /* Name.Tag */
    .codehilite .nv { color: #e36209 } /* Name.Variable */
    .codehilite .ow { color: #d73a49; font-weight: bold } /* Operator.Word */
    .codehilite .w { color: #bbbbbb } /* Text.Whitespace */
    .codehilite .mf { color: #005cc5 } /* Literal.Number.Float */
    .codehilite .mh { color: #005cc5 } /* Literal.Number.Hex */
    .codehilite .mi { color: #005cc5 } /* Literal.Number.Integer */
    .codehilite .mo { color: #005cc5 } /* Literal.Number.Oct */
    .codehilite .sb { color: #032f62 } /* Literal.String.Backtick */
    .codehilite .sc { color: #032f62 } /* Literal.String.Char */
    .codehilite .sd { color: #032f62 } /* Literal.String.Doc */
    .codehilite .s2 { color: #032f62 } /* Literal.String.Double */
    .codehilite .se { color: #005cc5 } /* Literal.String.Escape */
    .codehilite .sh { color: #032f62 } /* Literal.String.Heredoc */
    .codehilite .si { color: #032f62 } /* Literal.String.Interpol */
    .codehilite .sx { color: #032f62 } /* Literal.String.Other */
    .codehilite .sr { color: #032f62 } /* Literal.String.Regex */
    .codehilite .s1 { color: #032f62 } /* Literal.String.Single */
    .codehilite .ss { color: #005cc5 } /* Literal.String.Symbol */
    .codehilite .bp { color: #005cc5 } /* Name.Builtin.Pseudo */
    .codehilite .vc { color: #e36209 } /* Name.Variable.Class */
    .codehilite .vg { color: #e36209 } /* Name.Variable.Global */
    .codehilite .vi { color: #e36209 } /* Name.Variable.Instance */
    .codehilite .il { color: #005cc5 } /* Literal.Number.Integer.Long */
    
    /* Syntax Highlighting - DARK MODE (Monokai Overrides) */
    html.dark .codehilite .hll { background-color: #49483e }
    html.dark .codehilite .c { color: #75715e } /* Comment */
    html.dark .codehilite .err { color: #960050; background-color: #1e0010 } /* Error */
    html.dark .codehilite .k { color: #66d9ef; font-weight: normal } /* Keyword */
    html.dark .codehilite .l { color: #ae81ff } /* Literal */
    html.dark .codehilite .n { color: #f8f8f2 } /* Name */
    html.dark .codehilite .o { color: #f92672; font-weight: normal } /* Operator */
    html.dark .codehilite .p { color: #f8f8f2 } /* Punctuation */
    html.dark .codehilite .cm { color: #75715e } /* Comment.Multiline */
    html.dark .codehilite .cp { color: #75715e } /* Comment.Preproc */
    html.dark .codehilite .c1 { color: #75715e } /* Comment.Single */
    html.dark .codehilite .cs { color: #75715e } /* Comment.Special */
    html.dark .codehilite .ge { font-style: italic } /* Generic.Emph */
    html.dark .codehilite .gs { font-weight: bold } /* Generic.Strong */
    html.dark .codehilite .kc { color: #66d9ef; font-weight: normal } /* Keyword.Constant */
    html.dark .codehilite .kd { color: #66d9ef; font-weight: normal  } /* Keyword.Declaration */
    html.dark .codehilite .kn { color: #f92672; font-weight: normal  } /* Keyword.Namespace */
    html.dark .codehilite .kp { color: #66d9ef; font-weight: normal  } /* Keyword.Pseudo */
    html.dark .codehilite .kr { color: #66d9ef; font-weight: normal  } /* Keyword.Reserved */
    html.dark .codehilite .kt { color: #66d9ef; font-weight: normal  } /* Keyword.Type */
    html.dark .codehilite .ld { color: #e6db74 } /* Literal.Date */
    html.dark .codehilite .m { color: #ae81ff } /* Literal.Number */
    html.dark .codehilite .s { color: #e6db74 } /* Literal.String */
    html.dark .codehilite .na { color: #a6e22e } /* Name.Attribute */
    html.dark .codehilite .nb { color: #f8f8f2 } /* Name.Builtin */
    html.dark .codehilite .nc { color: #a6e22e } /* Name.Class */
    html.dark .codehilite .no { color: #66d9ef } /* Name.Constant */
    html.dark .codehilite .nd { color: #a6e22e } /* Name.Decorator */
    html.dark .codehilite .ni { color: #f8f8f2 } /* Name.Entity */
    html.dark .codehilite .ne { color: #a6e22e } /* Name.Exception */
    html.dark .codehilite .nf { color: #a6e22e } /* Name.Function */
    html.dark .codehilite .nl { color: #f8f8f2 } /* Name.Label */
    html.dark .codehilite .nn { color: #f8f8f2 } /* Name.Namespace */
    html.dark .codehilite .nx { color: #a6e22e } /* Name.Other */
    html.dark .codehilite .py { color: #f8f8f2 } /* Name.Property */
    html.dark .codehilite .nt { color: #f92672 } /* Name.Tag */
    html.dark .codehilite .nv { color: #f8f8f2 } /* Name.Variable */
    html.dark .codehilite .ow { color: #f92672; font-weight: normal  } /* Operator.Word */
    html.dark .codehilite .w { color: #f8f8f2 } /* Text.Whitespace */
    html.dark .codehilite .mb { color: #ae81ff } /* Literal.Number.Bin */
    html.dark .codehilite .mf { color: #ae81ff } /* Literal.Number.Float */
    html.dark .codehilite .mh { color: #ae81ff } /* Literal.Number.Hex */
    html.dark .codehilite .mi { color: #ae81ff } /* Literal.Number.Integer */
    html.dark .codehilite .mo { color: #ae81ff } /* Literal.Number.Oct */
    html.dark .codehilite .sb { color: #e6db74 } /* Literal.String.Backtick */
    html.dark .codehilite .sc { color: #e6db74 } /* Literal.String.Char */
    html.dark .codehilite .sd { color: #e6db74 } /* Literal.String.Doc */
    html.dark .codehilite .s2 { color: #e6db74 } /* Literal.String.Double */
    html.dark .codehilite .se { color: #ae81ff } /* Literal.String.Escape */
    html.dark .codehilite .sh { color: #e6db74 } /* Literal.String.Heredoc */
    html.dark .codehilite .si { color: #e6db74 } /* Literal.String.Interpol */
    html.dark .codehilite .sx { color: #e6db74 } /* Literal.String.Other */
    html.dark .codehilite .sr { color: #e6db74 } /* Literal.String.Regex */
    html.dark .codehilite .s1 { color: #e6db74 } /* Literal.String.Single */
    html.dark .codehilite .ss { color: #ae81ff } /* Literal.String.Symbol */
</style>

</head>
<body class="bg-[var(--bg-body)] text-[var(--text-body)] pt-20 transition-colors duration-300">

<!-- Navigation -->
<nav class="fixed top-0 left-0 right-0 bg-[var(--bg-card)]/90 backdrop-blur-md shadow-sm z-50 border-b border-[var(--border-color)] transition-colors duration-300">
    <div class="container mx-auto px-4 max-w-5xl h-16 flex items-center justify-between">
        <a href="../index.html" class="flex items-center space-x-3 text-[var(--text-headings)] hover:text-blue-600 transition-colors no-underline">
            <img src="../ops3_logo.png" alt="VUT Logo" class="h-12 w-auto object-contain">
            <div class="flex flex-col">
                <span class="font-bold text-lg leading-tight tracking-tight text-primary dark:text-sky-400 hidden sm:block">Operating Systems 3</span>
                <span class="text-xs text-slate-500 dark:text-slate-400 font-medium hidden sm:block">Virtualisation & Cloud Technologies</span>
                <span class="font-bold text-lg tracking-tight sm:hidden">OPS3</span>
            </div>
        </a>
        <div class="flex items-center space-x-6">
            <a href="../index.html" class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-sky-400 transition-colors no-underline">
                Course Home
            </a>
            <!-- Theme Toggle Button -->
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                <!-- Sun Icon -->
                <svg id="icon-sun" class="w-5 h-5 text-yellow-500 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <!-- Moon Icon -->
                <svg id="icon-moon" class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="container mx-auto px-4 max-w-5xl mb-12">
    <article class="prose lg:prose-lg max-w-none bg-[var(--bg-card)] p-6 md:p-12 rounded-xl shadow-sm border border-[var(--border-color)] transition-colors duration-300">
        <p><a href="../index.html">? Back to Course Index</a></p>
<div class="flex items-stretch bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm mb-8 overflow-hidden">
<div class="w-40 flex-shrink-0 flex items-center justify-center bg-white dark:bg-gray-900">
    <img src="images/week_4_icon.png" class="h-full w-full object-cover" alt="Storage Icon">
</div>
<div class="flex-1 flex flex-col items-center justify-center p-6">
    <h1 class="text-2xl font-bold text-primary dark:text-sky-400 m-0 text-center">Storage and Backup</h1>
    <span class="text-lg font-medium text-gray-500 dark:text-gray-400 mt-1">Student Notes</span>
</div>
</div>

<p><strong>Course</strong>: Computer Systems Engineering
<strong>Module</strong>: Operating Systems 3 (Virtualisation &amp; Cloud Technologies)
<strong>Topic</strong>: Storage and Backup
<strong>Estimated Reading Time</strong>: 25 Minutes</p>
<blockquote>
<p>[!TIP]
<strong>How to succeed in this week</strong>:
Storage decisions have long-term consequences. Understand the tradeoffs between local and shared storage, snapshots versus backups. The "3-2-1 backup rule" isn't just theory—it saves careers.</p>
</blockquote>
<hr />
<h2 id="welcome-to-week-4">Welcome to Week 4!</h2>
<p>You have learned how to create virtual machines (Compute) and how to connect them (Networking). Now, it is time to tackle the third and perhaps most critical pillar of the cloud: <strong>Storage</strong>.</p>
<p>In the physical world, if a hard drive fails, you lose data. In the virtual world, we have technologies like ZFS, Ceph, and Snapshots that make data resilient, portable, and practically immortal. This week, we move beyond simply "installing to a disk" and learn how the Linux kernel manages block devices, volume groups, and file systems.</p>
<hr />
<h2 id="what-youll-learn-this-week">What You'll Learn This Week</h2>
<ul>
<li><strong>Linux Storage primitives:</strong> Partitions, Block Devices, and Filesystems.</li>
<li><strong>Volume Management:</strong> Using <strong>LVM</strong> to resize disks on the fly.</li>
<li><strong>Next-Gen Storage:</strong> Using <strong>ZFS</strong> for instant snapshots and self-healing data.</li>
<li><strong>Proxmox Storage Architecture:</strong> How PVE manages Local vs. Shared storage.</li>
<li><strong>Disaster Recovery:</strong> The critical difference between a Snapshot and a Backup.</li>
</ul>
<hr />
<h1 id="part-1-linux-storage-fundamentals-revision-new-concepts">Part 1: Linux Storage Fundamentals (Revision + New Concepts)</h1>
<p>In Operating Systems 2, you gained hands-on experience with Linux storage management, including <strong>fdisk</strong> for partitioning, <strong>LVM</strong> for flexible volume management, and <strong>NFS</strong> for network-attached storage. This section begins with a focused revision of those familiar tools—reconnecting you with concepts like <code>/dev/sda</code>, <code>lsblk</code>, and <code>pvcreate</code>—but now viewed through the lens of virtualization. However, we will also introduce an entirely new storage technology: <strong>ZFS</strong>, the enterprise-grade filesystem that Proxmox relies on for advanced features like instant snapshots, self-healing data, and copy-on-write operations. While LVM and fdisk are foundational, ZFS represents the cutting edge of storage management in modern virtualized environments. Think of this as bridging your foundational Linux knowledge with enterprise virtualization infrastructure.</p>
<h2 id="1-block-devices-and-partitions">1. Block Devices and Partitions</h2>
<p>In Linux, everything is a file. A hard drive is a special type of file called a <strong>Block Device</strong>. The Linux kernel assigns specific naming conventions to different storage technologies. Traditional SATA and SCSI drives are represented as <code>/dev/sda</code>, <code>/dev/sdb</code>, and so on, while modern NVMe drives use a different naming scheme such as <code>/dev/nvme0n1</code> and <code>/dev/nvme1n1</code>. When a disk is divided into sections, these divisions are called partitions, and they are accessed through additional numerical suffixes—for example, <code>/dev/sda1</code> refers to the first partition on the first drive.</p>
<h3 id="11-examining-storage">1.1 Examining Storage</h3>
<p>One of the most powerful diagnostic tools in Linux is <code>lsblk</code> (List Block Devices), which provides a visual tree representation of all connected storage devices. When you run this command in the terminal, it displays a hierarchical view that shows physical disks, their partitions, and any logical volumes built on top of them. This tree structure makes it immediately clear which partitions belong to which disks and how storage is organized across the system. For administrators managing Proxmox servers, <code>lsblk</code> is indispensable for quickly understanding storage topology without needing to parse complex configuration files. The diagram below illustrates how Linux represents different types of storage devices and their partition schemes:</p>
<p><img alt="Linux Block Devices and Partitions" src="images/linux_block_devices.png" />
<em>Figure 1: Linux Block Devices and Partitions - How the kernel represents different storage types (SATA, NVMe, and their partitions)</em></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Tree view of all disks</span>
lsblk

<span class="c1"># Detailed view with UUIDs and Filesystem Types</span>
lsblk<span class="w"> </span>-f
</code></pre></div>

<h3 id="12-managing-partitions-fdisk">1.2 Managing Partitions (<code>fdisk</code>)</h3>
<p>To create a formatted space on a disk, we use <code>fdisk</code> or <code>parted</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Open the utility for disk /dev/sdb</span>
sudo<span class="w"> </span>fdisk<span class="w"> </span>/dev/sdb
<span class="c1"># Commands inside tool:</span>
<span class="c1"># &#39;n&#39; -&gt; New Partition</span>
<span class="c1"># &#39;w&#39; -&gt; Write Changes</span>
</code></pre></div>

<h3 id="section-1-checkpoint">Section 1 Checkpoint</h3>
<p><strong>Summary</strong>: Linux treats disks as <strong>Block Devices</strong> (such as <code>/dev/sda</code>), and the <code>lsblk</code> command visualizes the storage hierarchy in a tree format while <code>fdisk</code> is used to create partitions. It is important to understand that Proxmox needs the underlying operating system to recognize and manage the disk before it can use it for virtual machine storage.</p>
<p><strong>Reflection</strong>: Consider why NVMe drives have names like <code>nvme0n1</code> instead of <code>sda</code>. What happens if you attempt to partition a disk that is already mounted and actively in use?</p>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://wiki.archlinux.org/title/Fdisk">Arch Wiki: Fdisk</a></li>
</ul>
<hr />
<h2 id="2-logical-volume-manager-lvm">2. Logical Volume Manager (LVM)</h2>
<p>Traditional partitions are rigid. If <code>/dev/sda1</code> is 10GB and fills up, you cannot easily "grow" it if <code>/dev/sda2</code> is right next to it. <strong>LVM</strong> abstracts physical disks into a flexible pool of storage.</p>
<h3 id="21-the-lvm-hierarchy">2.1 The LVM Hierarchy</h3>
<p>The three-tier architecture of LVM provides the flexibility that traditional partitions lack. As shown in the diagram below, the hierarchy flows from physical disks to virtual volumes:</p>
<p><img alt="LVM Architecture - Three-Tier Hierarchy" src="images/lvm_hierarchy.png" />
<em>Figure 2: LVM Three-Tier Hierarchy - Physical Volumes (PV) combine into Volume Groups (VG), which are divided into Logical Volumes (LV)</em></p>
<p>The hierarchy consists of three layers. At the foundation is the <strong>Physical Volume (PV)</strong>, which represents the actual disk or partition (for example, <code>/dev/sdb</code>). These physical volumes are then combined into a <strong>Volume Group (VG)</strong>, which acts as a unified storage pool—for instance, a <code>data_pool</code> might aggregate multiple drives to provide 500GB of total capacity. Finally, <strong>Logical Volumes (LV)</strong> are carved out from the volume group and allocated for specific uses, such as <code>vm-100-disk</code> for a virtual machine.</p>
<h3 id="22-hands-on-lvm-commands">2.2 Hands-On LVM Commands</h3>
<p>Proxmox uses LVM extensively. Here is how you manage it manually.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Initialize a disk for LVM</span>
sudo<span class="w"> </span>pvcreate<span class="w"> </span>/dev/sdb

<span class="c1"># 2. Create a Volume Group named &#39;data_vg&#39;</span>
sudo<span class="w"> </span>vgcreate<span class="w"> </span>data_vg<span class="w"> </span>/dev/sdb

<span class="c1"># 3. Create a 10GB Logical Volume</span>
sudo<span class="w"> </span>lvcreate<span class="w"> </span>-n<span class="w"> </span>my_volume<span class="w"> </span>-L<span class="w"> </span>10G<span class="w"> </span>data_vg

<span class="c1"># 4. View your work</span>
sudo<span class="w"> </span>vgs<span class="w">  </span><span class="c1"># View Groups</span>
sudo<span class="w"> </span>lvs<span class="w">  </span><span class="c1"># View Volumes</span>
</code></pre></div>

<h3 id="section-2-checkpoint">Section 2 Checkpoint</h3>
<p><strong>Summary</strong>: <strong>LVM</strong> adds significant flexibility over static partitions, enabling dynamic resizing and storage pooling. The architectural flow moves from <strong>PV</strong> (Physical Volume) to <strong>VG</strong> (Volume Group) to <strong>LV</strong> (Logical Volume), and Proxmox installs to LVM by default to take advantage of these capabilities.</p>
<p><strong>Reflection</strong>: Can you shrink an LVM volume while it is online and actively in use? What is the difference between standard LVM and LVM-Thin provisioning?</p>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/logical_volume_manager_administration/index">Red Hat LVM Administration</a></li>
</ul>
<hr />
<h2 id="3-zfs-the-enterprise-standard-new-material">3. ZFS: The Enterprise Standard (New Material)</h2>
<p><strong>ZFS (Zettabyte File System)</strong> is vastly superior to standard hardware RAID. It manages the physical disks directly and provides checksumming, compression, and deduplication.</p>
<h3 id="31-why-zfs">3.1 Why ZFS?</h3>
<p><strong>Copy-on-Write (CoW)</strong> is one of ZFS's foundational design principles. When you edit a file, ZFS does not overwrite the old data in place. Instead, it writes the new data to a fresh block on the disk and then updates the pointer to reference the new location. The benefit of this approach is profound: if power fails during a write operation, the old data remains valid and intact. There is no corruption because the original block is never destroyed until the write is confirmed to be successful.</p>
<p>The illustration below compares traditional write operations (which overwrite data in place) versus ZFS's Copy-on-Write approach:</p>
<p><img alt="ZFS Copy-on-Write Mechanism" src="images/zfs_cow.png" />
<em>Figure 3: ZFS Copy-on-Write (CoW) - Traditional filesystems overwrite data in place; ZFS writes to new blocks and updates pointers</em></p>
<p><strong>Self-Healing</strong> is another critical feature of ZFS. The filesystem stores a cryptographic checksum (a digital fingerprint) for every block of data. If a cosmic ray flips a bit on your drive—an event known as bit rot—ZFS detects the mismatch between the data and its checksum. If redundancy exists (such as in a mirrored or RAID-Z configuration), ZFS automatically repairs the corrupted block by restoring it from a valid copy.</p>
<p>The self-healing process is visualized below, showing how ZFS detects, validates, and repairs corrupted data blocks:</p>
<p><img alt="ZFS Self-Healing Process" src="images/zfs_healing.png" />
<em>Figure 4: ZFS Self-Healing - Checksums detect corrupted blocks, which are automatically repaired from redundant copies</em></p>
<h3 id="32-basic-zfs-commands">3.2 Basic ZFS Commands</h3>
<p>Proxmox installs ZFS tools by default.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Check the health of your storage pool</span>
sudo<span class="w"> </span>zpool<span class="w"> </span>status

<span class="c1"># 2. List all datasets (file systems)</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>list

<span class="c1"># 3. Create a new dataset for ISOs</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>create<span class="w"> </span>rpool/isos
</code></pre></div>

<h3 id="33-the-power-of-instant-snapshots">3.3 The Power of Instant Snapshots</h3>
<p>The Copy-on-Write architecture unlocks one of ZFS's most remarkable capabilities: instantaneous snapshots. Unlike traditional backup systems that must copy gigabytes or terabytes of data (a process that can take hours), a ZFS snapshot is merely a metadata operation—a lightweight bookmark that marks the current state of the filesystem. When you create a snapshot, ZFS doesn't duplicate any data blocks; it simply freezes a reference point in time. The snapshot consumes zero disk space initially because it shares all its data blocks with the current filesystem. Only when data begins to change does the snapshot start consuming space, as ZFS preserves the old blocks that the snapshot references while writing new data to fresh locations. This means you can take a snapshot of a 1TB virtual machine in less than a second, with no performance impact and no initial storage overhead.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Take a snapshot of a dataset</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>snapshot<span class="w"> </span>rpool/data/vm-100-disk-0@before_update

<span class="c1"># 2. Rollback (Undo changes)</span>
sudo<span class="w"> </span>zfs<span class="w"> </span>rollback<span class="w"> </span>rpool/data/vm-100-disk-0@before_update
</code></pre></div>

<h3 id="section-3-checkpoint">Section 3 Checkpoint</h3>
<p><strong>Summary</strong>: <strong>ZFS</strong> is a next-generation filesystem with RAID, Copy-on-Write, and checksumming built directly into its architecture. Its <strong>self-healing</strong> capability detects and fixes silent data corruption (commonly known as bit rot), while <strong>snapshots</strong> are instantaneous and consume zero space initially due to the Copy-on-Write mechanism.</p>
<p><strong>Reflection</strong>: Why does ZFS need direct access to the disk (passthrough) rather than working through a traditional RAID controller? What is the "ARC" in ZFS terms, and how does it improve performance?</p>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://openzfs.org/wiki/Main_Page">OpenZFS Documentation</a></li>
</ul>
<hr />
<h2 id="4-virtual-disk-formats">4. Virtual Disk Formats</h2>
<p>When you create a VM, its hard drive is just a file on the host.</p>
<h3 id="41-raw-raw">4.1 Raw (<code>.raw</code>)</h3>
<p>The Raw disk format is effectively a bit-for-bit representation of a hard drive without any additional metadata or container structure. Because it lacks a translation layer, the file is read and written directly to the underlying block device, making it the most performant option available. However, this simplicity comes at a cost; creating a 100GB Raw disk immediately consumes 100GB of physical space (unless sparse provisioning is strictly enforced), and it does not support advanced features like internal snapshots. If you require snapshot capabilities with Raw disks, you must rely on the underlying storage system, such as LVM-Thin or ZFS, to handle them.</p>
<h3 id="42-qcow2-qemu-copy-on-write">4.2 QCOW2 (QEMU Copy On Write)</h3>
<p>QCOW2 is a functional, feature-rich format designed specifically for the QEMU emulator. Unlike Raw, it acts as an intelligent container that creates a layer of abstraction between the VM and the physical disk. This allows for powerful features such as internal snapshots, transparent compression, and encryption directly within the file itself. While this abstraction layer introduces a minor performance overhead compared to Raw, the flexibility it offers—particularly the ability to grow the disk file dynamically as data is added—makes it the standard choice for file-based storage backends like NFS or local directories.</p>
<h3 id="43-summary-comparison">4.3 Summary Comparison</h3>
<p>The visual comparison below highlights the key differences between Raw and QCOW2 disk formats:</p>
<p><img alt="Virtual Disk Format Comparison" src="images/disk_formats.png" />
<em>Figure 5: Virtual Disk Formats - Raw disks offer maximum performance while QCOW2 provides flexibility with snapshots and thin provisioning</em></p>
<table>
<thead>
<tr>
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">Raw (<code>.raw</code>)</th>
<th style="text-align: left;">QCOW2</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Performance</strong></td>
<td style="text-align: left;">Highest (Near Native)</td>
<td style="text-align: left;">High (Slight Overhead)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Space Usage</strong></td>
<td style="text-align: left;">Fixed (Pre-allocated)</td>
<td style="text-align: left;">Dynamic (Grow on demand)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Snapshots</strong></td>
<td style="text-align: left;">Requires ZFS/LVM support</td>
<td style="text-align: left;">Built-in (Internal)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Portability</strong></td>
<td style="text-align: left;">Universal (Byte stream)</td>
<td style="text-align: left;">QEMU Specific</td>
</tr>
<tr>
<td style="text-align: left;">### Section 4 Checkpoint</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;"><strong>Summary</strong>:</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Raw</strong>: Fast, pre-allocated, simple. Good for Ceph/LVM.</li>
<li><strong>QCOW2</strong>: Flexible, thin-provisioned, internal snapshots. Good for Directory/NFS.</li>
<li>Trade-off is usually Performance vs Flexibility.</li>
</ul>
<p><strong>Reflection</strong>:</p>
<ul>
<li>Why can't you take an internal snapshot on a Raw disk?</li>
<li>How does "sparse provisioning" differ from "thin provisioning"?</li>
</ul>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://qemu.readthedocs.io/en/latest/system/images.html">QEMU Disk Images</a></li>
</ul>
<hr />
<h2 id="8-additional-resources">8. Additional Resources</h2>
<ul>
<li><strong>Proxmox Storage Wiki</strong>: <a href="https://pve.proxmox.com/wiki/Storage">Official Docs</a></li>
<li><strong>ZFS for Dummies</strong>: <a href="https://arstechnica.com/information-technology/2020/05/zfs-101-understanding-zfs-storage-and-performance/">ArsTechnica Guide</a></li>
<li><strong>LVM Cheat Sheet</strong>: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/logical_volume_manager_administration/index">Red Hat LVM</a></li>
</ul>
<hr />
<h2 id="9-lab-exercises">9. Lab Exercises</h2>
<ul>
<li><strong><a href="Week_4_Lab_1_Storage.html">Lab 1: Storage</a></strong><ul>
<li><strong>Goal</strong>: Introduction to Local Storage and LVM.</li>
</ul>
</li>
<li><strong><a href="Week_4_Lab_2_Shared_Storage.html">Lab 2: Shared Storage</a></strong><ul>
<li><strong>Goal</strong>: Connecting to NFS and iSCSI targets.</li>
</ul>
</li>
</ul>
<p><a href="../index.html">? Back to Course Index</a></p>
                <div class="mt-12 p-8 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 text-center">
                    <h3 class="text-2xl font-bold text-[var(--text-headings)] mb-4">Test Your Knowledge</h3>
                    <p class="text-[var(--text-body)] mb-6">Ready to check your understanding of this week's material? Take the interactive quiz now!</p>
                    <a href="Week_4_Quiz.html" id="start-quiz-btn" class="inline-block px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors shadow-md no-underline">
                        Start Quiz
                    </a>
                </div>
                
    </article>
</main>

<!-- Footer -->
<footer class="text-center text-slate-500 dark:text-slate-400 text-sm pb-8">
</footer>

<!-- Progress Tracking -->
<script src="../js/course_logic.js"></script>

</body>
</html>

