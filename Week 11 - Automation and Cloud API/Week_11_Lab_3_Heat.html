
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Week 11 Lab 3 Heat</title>

<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                },
                colors: {
                    primary: '#002F6E', // VUT Midnight Blue
                    secondary: '#6c757d',
                    codebg: 'var(--bg-code)', 
                },
                typography: {
                    DEFAULT: {
                        css: {
                            maxWidth: '100%',
                            fontFamily: 'Inter, sans-serif',
                            color: 'var(--text-body)',
                            '--tw-prose-body': 'var(--text-body)',
                            '--tw-prose-headings': 'var(--text-headings)',
                            '--tw-prose-links': 'var(--text-link)',
                            '--tw-prose-bold': 'var(--text-headings)',
                            '--tw-prose-counters': 'var(--text-body)',
                            '--tw-prose-bullets': 'var(--text-body)',
                            '--tw-prose-hr': 'var(--border-color)',
                            '--tw-prose-quotes': 'var(--text-body)',
                            '--tw-prose-code': 'var(--text-code)',
                            '--tw-prose-pre-code': 'var(--text-pre)',
                            '--tw-prose-pre-bg': 'var(--bg-pre)',
                            
                            // Image Sizing Control
                            img: {
                                display: 'block',
                                marginLeft: 'auto',
                                marginRight: 'auto',
                                maxHeight: '500px',
                                width: 'auto',
                                height: 'auto',
                                borderRadius: '0.5rem',
                                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                            },
                            // Links
                            a: {
                                color: 'var(--text-link)',
                                '&:hover': { opacity: '0.8' },
                            },
                            // Inline Code
                            code: {
                                color: 'var(--text-code)',
                                backgroundColor: 'var(--bg-code)',
                                padding: '0.2rem 0.4rem',
                                borderRadius: '0.25rem',
                                fontWeight: '600',
                                border: '1px solid var(--border-code)',
                            },
                            'code::before': { content: '""' },
                            'code::after': { content: '""' },
                            // Code Blocks (Pre)
                            pre: {
                                backgroundColor: 'var(--bg-pre) !important',
                                color: 'var(--text-pre)',
                                padding: '1rem',
                                borderRadius: '0.5rem',
                                border: '1px solid var(--border-pre)',
                            },
                            // Notes/Alerts (Blockquotes)
                            blockquote: {
                                borderLeftColor: '#002F6E',
                                borderLeftWidth: '4px',
                                backgroundColor: 'var(--bg-note)',
                                padding: '1rem',
                                color: 'var(--text-body)',
                                fontSize: '0.9rem', // Smaller text for notes
                                fontStyle: 'italic',
                                quotes: 'none',
                                borderRadius: '0 0.5rem 0.5rem 0',
                            },
                            'blockquote p:first-of-type::before': { content: 'none' },
                            'blockquote p:last-of-type::after': { content: 'none' },
                            // Tables (Restored from First Attempt)
                            table: {
                                width: '100%',
                                marginTop: '2em',
                                marginBottom: '2em',
                                borderCollapse: 'collapse',
                                fontSize: '0.9rem',
                            },
                            'thead th': {
                                backgroundColor: '#f3f4f6', 
                                color: '#1f2937', 
                                fontWeight: '600',
                                padding: '0.75rem',
                                borderBottom: '2px solid #e5e7eb',
                                textAlign: 'left',
                            },
                            'tbody td': {
                                padding: '0.75rem',
                                borderBottom: '1px solid #e5e7eb',
                                verticalAlign: 'top',
                            },
                            'tbody tr:hover': {
                                backgroundColor: '#f9fafb',
                            },
                            
                            // Task Lists (Checkboxes)
                            '.task-list-item': {
                                listStyleType: 'none',
                            },
                            '.task-list-item input[type="checkbox"]': {
                                marginRight: '0.5rem',
                            },

                            thead: {
                                borderBottomWidth: '2px',
                                borderBottomColor: 'var(--border-color)',
                            },
                            'thead th': {
                                color: 'var(--text-headings)',
                                fontWeight: '600',
                                verticalAlign: 'bottom',
                                paddingRight: '0.75em',
                                paddingBottom: '0.75em',
                                paddingLeft: '0.75em',
                                textAlign: 'left',
                            },
                            'tbody tr': {
                                borderBottomWidth: '1px',
                                borderBottomColor: 'var(--border-color)',
                            },
                            'tbody tr:last-child': {
                                borderBottomWidth: '0',
                            },
                            'tbody td': {
                                verticalAlign: 'top',
                                padding: '0.75em',
                            },
                        },
                    },
                },
            },
        },
    }
</script>
<script>
    // Theme Toggle Logic
    document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const iconSun = document.getElementById('icon-sun');
        const iconMoon = document.getElementById('icon-moon');

        // Check local storage or preference
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
            iconSun.classList.remove('hidden');
            iconMoon.classList.add('hidden');
        } else {
            html.classList.remove('dark');
            iconSun.classList.add('hidden');
            iconMoon.classList.remove('hidden');
        }

        themeToggle.addEventListener('click', () => {
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.theme = 'light';
                iconSun.classList.add('hidden');
                iconMoon.classList.remove('hidden');
            } else {
                html.classList.add('dark');
                localStorage.theme = 'dark';
                iconSun.classList.remove('hidden');
                iconMoon.classList.add('hidden');
            }
        });
    });
</script>
<style>
    /* CSS Variables for Theming */
    :root {
        --bg-body: #f8fafc;
        --bg-card: #ffffff;
        --text-body: #334155;
        --text-headings: #0f172a;
        --text-link: #002F6E; /* VUT Blue */
        --border-color: #e2e8f0;
        
        /* Code - Light Mode */
        --bg-code: #f1f5f9;
        --text-code: #d63384;
        --border-code: #e2e8f0;
        
        /* Pre - Light Mode (Github Light) */
        --bg-pre: #f6f8fa;
        --text-pre: #24292e;
        --border-pre: #d0d7de;
        
        /* Note - Light Mode */
        --bg-note: #f8f9fa;
        
        /* Scrollbar */
        --scroll-track: #f1f1f1;
        --scroll-thumb: #888;
    }

    html.dark {
        --bg-body: #0f172a;
        --bg-card: #1e293b;
        --text-body: #cbd5e1;
        --text-headings: #f8fafc;
        --text-link: #60a5fa; /* Blue 400 - Brighter for better contrast */
        --border-color: #334155;
        
        /* Code - Dark Mode */
        --bg-code: #334155;
        --text-code: #f472b6; 
        --border-code: #475569;
        
        /* Pre - Dark Mode (Monokai) */
        --bg-pre: #272822;
        --text-pre: #f8f8f2;
        --border-pre: #464539;
        
        /* Note - Dark Mode */
        --bg-note: #1e293b;
        --scroll-track: #1e293b;
        --scroll-thumb: #475569;
    }

    /* Transition */
    body, article, code, pre, blockquote {
        transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--scroll-track); }
    ::-webkit-scrollbar-thumb { background: var(--scroll-thumb); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
    
    /* Syntax Highlighting - LIGHT MODE (GitHub Light Inspired) */
    .codehilite .hll { background-color: #ffffcc }
    .codehilite .c { color: #6a737d; font-style: italic } /* Comment */
    .codehilite .err { color: #f05240; background-color: #ffeaea } /* Error */
    .codehilite .k { color: #d73a49; font-weight: bold } /* Keyword */
    .codehilite .o { color: #d73a49; font-weight: bold } /* Operator */
    .codehilite .cm { color: #6a737d; font-style: italic } /* Comment.Multiline */
    .codehilite .cp { color: #6a737d; font-weight: bold } /* Comment.Preproc */
    .codehilite .c1 { color: #6a737d; font-style: italic } /* Comment.Single */
    .codehilite .cs { color: #6a737d; font-style: italic } /* Comment.Special */
    .codehilite .gd { color: #d73a49; background-color: #fdd } /* Generic.Deleted */
    .codehilite .ge { font-style: italic } /* Generic.Emph */
    .codehilite .gr { color: #aa0000 } /* Generic.Error */
    .codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
    .codehilite .gi { color: #00a000; background-color: #dfd } /* Generic.Inserted */
    .codehilite .go { color: #888888 } /* Generic.Output */
    .codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
    .codehilite .gs { font-weight: bold } /* Generic.Strong */
    .codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
    .codehilite .gt { color: #aa0000 } /* Generic.Traceback */
    .codehilite .kc { color: #005cc5; font-weight: bold } /* Keyword.Constant */
    .codehilite .kd { color: #d73a49; font-weight: bold } /* Keyword.Declaration */
    .codehilite .kn { color: #d73a49; font-weight: bold } /* Keyword.Namespace */
    .codehilite .kp { color: #d73a49 } /* Keyword.Pseudo */
    .codehilite .kr { color: #d73a49; font-weight: bold } /* Keyword.Reserved */
    .codehilite .kt { color: #445588; font-weight: bold } /* Keyword.Type */
    .codehilite .m { color: #005cc5 } /* Literal.Number */
    .codehilite .s { color: #032f62 } /* Literal.String */
    .codehilite .na { color: #22863a } /* Name.Attribute */
    .codehilite .nb { color: #005cc5 } /* Name.Builtin */
    .codehilite .nc { color: #6f42c1; font-weight: bold } /* Name.Class */
    .codehilite .no { color: #005cc5 } /* Name.Constant */
    .codehilite .nd { color: #6f42c1; font-weight: bold } /* Name.Decorator */
    .codehilite .ni { color: #800080 } /* Name.Entity */
    .codehilite .ne { color: #990000; font-weight: bold } /* Name.Exception */
    .codehilite .nf { color: #6f42c1; font-weight: bold } /* Name.Function */
    .codehilite .nl { color: #990000; font-weight: bold } /* Name.Label */
    .codehilite .nn { color: #6f42c1; font-weight: bold } /* Name.Namespace */
    .codehilite .nt { color: #22863a } /* Name.Tag */
    .codehilite .nv { color: #e36209 } /* Name.Variable */
    .codehilite .ow { color: #d73a49; font-weight: bold } /* Operator.Word */
    .codehilite .w { color: #bbbbbb } /* Text.Whitespace */
    .codehilite .mf { color: #005cc5 } /* Literal.Number.Float */
    .codehilite .mh { color: #005cc5 } /* Literal.Number.Hex */
    .codehilite .mi { color: #005cc5 } /* Literal.Number.Integer */
    .codehilite .mo { color: #005cc5 } /* Literal.Number.Oct */
    .codehilite .sb { color: #032f62 } /* Literal.String.Backtick */
    .codehilite .sc { color: #032f62 } /* Literal.String.Char */
    .codehilite .sd { color: #032f62 } /* Literal.String.Doc */
    .codehilite .s2 { color: #032f62 } /* Literal.String.Double */
    .codehilite .se { color: #005cc5 } /* Literal.String.Escape */
    .codehilite .sh { color: #032f62 } /* Literal.String.Heredoc */
    .codehilite .si { color: #032f62 } /* Literal.String.Interpol */
    .codehilite .sx { color: #032f62 } /* Literal.String.Other */
    .codehilite .sr { color: #032f62 } /* Literal.String.Regex */
    .codehilite .s1 { color: #032f62 } /* Literal.String.Single */
    .codehilite .ss { color: #005cc5 } /* Literal.String.Symbol */
    .codehilite .bp { color: #005cc5 } /* Name.Builtin.Pseudo */
    .codehilite .vc { color: #e36209 } /* Name.Variable.Class */
    .codehilite .vg { color: #e36209 } /* Name.Variable.Global */
    .codehilite .vi { color: #e36209 } /* Name.Variable.Instance */
    .codehilite .il { color: #005cc5 } /* Literal.Number.Integer.Long */
    
    /* Syntax Highlighting - DARK MODE (Monokai Overrides) */
    html.dark .codehilite .hll { background-color: #49483e }
    html.dark .codehilite .c { color: #75715e } /* Comment */
    html.dark .codehilite .err { color: #960050; background-color: #1e0010 } /* Error */
    html.dark .codehilite .k { color: #66d9ef; font-weight: normal } /* Keyword */
    html.dark .codehilite .l { color: #ae81ff } /* Literal */
    html.dark .codehilite .n { color: #f8f8f2 } /* Name */
    html.dark .codehilite .o { color: #f92672; font-weight: normal } /* Operator */
    html.dark .codehilite .p { color: #f8f8f2 } /* Punctuation */
    html.dark .codehilite .cm { color: #75715e } /* Comment.Multiline */
    html.dark .codehilite .cp { color: #75715e } /* Comment.Preproc */
    html.dark .codehilite .c1 { color: #75715e } /* Comment.Single */
    html.dark .codehilite .cs { color: #75715e } /* Comment.Special */
    html.dark .codehilite .ge { font-style: italic } /* Generic.Emph */
    html.dark .codehilite .gs { font-weight: bold } /* Generic.Strong */
    html.dark .codehilite .kc { color: #66d9ef; font-weight: normal } /* Keyword.Constant */
    html.dark .codehilite .kd { color: #66d9ef; font-weight: normal  } /* Keyword.Declaration */
    html.dark .codehilite .kn { color: #f92672; font-weight: normal  } /* Keyword.Namespace */
    html.dark .codehilite .kp { color: #66d9ef; font-weight: normal  } /* Keyword.Pseudo */
    html.dark .codehilite .kr { color: #66d9ef; font-weight: normal  } /* Keyword.Reserved */
    html.dark .codehilite .kt { color: #66d9ef; font-weight: normal  } /* Keyword.Type */
    html.dark .codehilite .ld { color: #e6db74 } /* Literal.Date */
    html.dark .codehilite .m { color: #ae81ff } /* Literal.Number */
    html.dark .codehilite .s { color: #e6db74 } /* Literal.String */
    html.dark .codehilite .na { color: #a6e22e } /* Name.Attribute */
    html.dark .codehilite .nb { color: #f8f8f2 } /* Name.Builtin */
    html.dark .codehilite .nc { color: #a6e22e } /* Name.Class */
    html.dark .codehilite .no { color: #66d9ef } /* Name.Constant */
    html.dark .codehilite .nd { color: #a6e22e } /* Name.Decorator */
    html.dark .codehilite .ni { color: #f8f8f2 } /* Name.Entity */
    html.dark .codehilite .ne { color: #a6e22e } /* Name.Exception */
    html.dark .codehilite .nf { color: #a6e22e } /* Name.Function */
    html.dark .codehilite .nl { color: #f8f8f2 } /* Name.Label */
    html.dark .codehilite .nn { color: #f8f8f2 } /* Name.Namespace */
    html.dark .codehilite .nx { color: #a6e22e } /* Name.Other */
    html.dark .codehilite .py { color: #f8f8f2 } /* Name.Property */
    html.dark .codehilite .nt { color: #f92672 } /* Name.Tag */
    html.dark .codehilite .nv { color: #f8f8f2 } /* Name.Variable */
    html.dark .codehilite .ow { color: #f92672; font-weight: normal  } /* Operator.Word */
    html.dark .codehilite .w { color: #f8f8f2 } /* Text.Whitespace */
    html.dark .codehilite .mb { color: #ae81ff } /* Literal.Number.Bin */
    html.dark .codehilite .mf { color: #ae81ff } /* Literal.Number.Float */
    html.dark .codehilite .mh { color: #ae81ff } /* Literal.Number.Hex */
    html.dark .codehilite .mi { color: #ae81ff } /* Literal.Number.Integer */
    html.dark .codehilite .mo { color: #ae81ff } /* Literal.Number.Oct */
    html.dark .codehilite .sb { color: #e6db74 } /* Literal.String.Backtick */
    html.dark .codehilite .sc { color: #e6db74 } /* Literal.String.Char */
    html.dark .codehilite .sd { color: #e6db74 } /* Literal.String.Doc */
    html.dark .codehilite .s2 { color: #e6db74 } /* Literal.String.Double */
    html.dark .codehilite .se { color: #ae81ff } /* Literal.String.Escape */
    html.dark .codehilite .sh { color: #e6db74 } /* Literal.String.Heredoc */
    html.dark .codehilite .si { color: #e6db74 } /* Literal.String.Interpol */
    html.dark .codehilite .sx { color: #e6db74 } /* Literal.String.Other */
    html.dark .codehilite .sr { color: #e6db74 } /* Literal.String.Regex */
    html.dark .codehilite .s1 { color: #e6db74 } /* Literal.String.Single */
    html.dark .codehilite .ss { color: #ae81ff } /* Literal.String.Symbol */
</style>

</head>
<body class="bg-[var(--bg-body)] text-[var(--text-body)] pt-20 transition-colors duration-300">

<!-- Navigation -->
<nav class="fixed top-0 left-0 right-0 bg-[var(--bg-card)]/90 backdrop-blur-md shadow-sm z-50 border-b border-[var(--border-color)] transition-colors duration-300">
    <div class="container mx-auto px-4 max-w-5xl h-16 flex items-center justify-between">
        <a href="../index.html" class="flex items-center space-x-3 text-[var(--text-headings)] hover:text-blue-600 transition-colors no-underline">
            <img src="../ops3_logo.png" alt="VUT Logo" class="h-12 w-auto object-contain">
            <div class="flex flex-col">
                <span class="font-bold text-lg leading-tight tracking-tight text-primary dark:text-sky-400 hidden sm:block">Operating Systems 3</span>
                <span class="text-xs text-slate-500 dark:text-slate-400 font-medium hidden sm:block">Virtualisation & Cloud Technologies</span>
                <span class="font-bold text-lg tracking-tight sm:hidden">OPS3</span>
            </div>
        </a>
        <div class="flex items-center space-x-6">
            <a href="../index.html" class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-sky-400 transition-colors no-underline">
                Course Home
            </a>
            <!-- Theme Toggle Button -->
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                <!-- Sun Icon -->
                <svg id="icon-sun" class="w-5 h-5 text-yellow-500 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <!-- Moon Icon -->
                <svg id="icon-moon" class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="container mx-auto px-4 max-w-5xl mb-12">
    <article class="prose lg:prose-lg max-w-none bg-[var(--bg-card)] p-6 md:p-12 rounded-xl shadow-sm border border-[var(--border-color)] transition-colors duration-300">
        <p><a href="../index.html">← Back to Course Index</a></p>
<h1 id="week-11-lab-3-declarative-infrastructure-with-heat">Week 11 Lab 3: Declarative Infrastructure with Heat</h1>
<p><strong>Module</strong>: Operating Systems 3 (Virtualisation &amp; Cloud Technologies)</p>
<p><strong>Estimated Time</strong>: 45 Minutes<br />
<strong>Lab Type</strong>: YAML / Orchestration  </p>
<hr />
<h2 id="lab-overview">Lab Overview</h2>
<p>In Lab 1, you wrote a Bash script to launch a server. In Lab 2, you used Ansible to configure it.
Now, we will replace the <strong>Imperative</strong> Bash script with a <strong>Declarative</strong> Heat Template.</p>
<p><strong>The Difference</strong>:</p>
<ul>
<li><strong>Bash</strong>: "Run this command, then run that command." (If you run it twice, it breaks).</li>
<li><strong>Heat</strong>: "Here is the final state I want." (If you run it twice, it does nothing because the state is already reached).</li>
</ul>
<p><strong>Objectives</strong>:
1.  <strong>Write a Template</strong>: Create a <code>deployment.yaml</code> file describing the network, security group, and server.
2.  <strong>Deploy a Stack</strong>: Use <code>openstack stack create</code>.
3.  <strong>Update a Stack</strong>: Change the configuration and watch Heat apply only the delta.
4.  <strong>Clean Up</strong>: Delete the entire environment with one command.</p>
<p><strong>Prerequisites</strong>:</p>
<ul>
<li>MicroStack running.</li>
<li><code>jq</code> tool installed.</li>
</ul>
<hr />
<h2 id="part-1-writing-the-template">Part 1: Writing the Template</h2>
<ol>
<li>
<p><strong>Create the file</strong>:
    <code>bash
    nano deployment.yaml</code></p>
</li>
<li>
<p><strong>Add the Infrastructure Definition</strong>:
    We will define a Network, a Security Group allowing SSH/HTTP, and a Server.</p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="nt">heat_template_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2018-08-31</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Lab 3 Declarative Stack</span>

<span class="nt">parameters</span><span class="p">:</span>
<span class="w">  </span><span class="nt">key_name</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lab-key</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name of the keypair to use</span>
<span class="w">  </span><span class="nt">image_name</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">  </span><span class="nt">public_net</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external</span>

<span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 1. The Network</span>
<span class="w">  </span><span class="nt">app_net</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OS::Neutron::Net</span>

<span class="w">  </span><span class="nt">app_subnet</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OS::Neutron::Subnet</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_resource</span><span class="p">:</span><span class="w"> </span><span class="nv">app_net</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.20.0/24</span><span class="w">  </span><span class="c1"># Different subnet from Lab 1</span>
<span class="w">      </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">         </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_param</span><span class="p">:</span><span class="w"> </span><span class="nv">public_net</span><span class="w"> </span><span class="p p-Indicator">}</span>

<span class="w">  </span><span class="c1"># 2. The Security Group</span>
<span class="w">  </span><span class="nt">web_sg</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OS::Neutron::SecurityGroup</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Allow</span><span class="nv"> </span><span class="s">SSH</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">HTTP&quot;</span>
<span class="w">      </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">          </span><span class="nt">port_range_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22</span>
<span class="w">          </span><span class="nt">port_range_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22</span>
<span class="w">          </span><span class="nt">remote_ip_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">          </span><span class="nt">port_range_min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">port_range_max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">          </span><span class="nt">remote_ip_prefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0/0</span>

<span class="w">  </span><span class="c1"># 3. The Server</span>
<span class="w">  </span><span class="nt">web_instance</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OS::Nova::Server</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">heat-web-01</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_param</span><span class="p">:</span><span class="w"> </span><span class="nv">image_name</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">flavor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">m1.tiny</span>
<span class="w">      </span><span class="nt">key_name</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_param</span><span class="p">:</span><span class="w"> </span><span class="nv">key_name</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">networks</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_resource</span><span class="p">:</span><span class="w"> </span><span class="nv">app_net</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">security_groups</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_resource</span><span class="p">:</span><span class="w"> </span><span class="nv">web_sg</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">user_data</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">        </span><span class="no">#cloud-config</span>
<span class="w">        </span><span class="no">packages:</span>
<span class="w">          </span><span class="no">- nginx # Note: Standardizing on Nginx for this lab</span>
<span class="w">        </span><span class="no">runcmd:</span>
<span class="w">          </span><span class="no">- systemctl start nginx</span>

<span class="w">  </span><span class="c1"># 4. Floating IP</span>
<span class="w">  </span><span class="nt">my_ip</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OS::Neutron::FloatingIP</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">floating_network</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_param</span><span class="p">:</span><span class="w"> </span><span class="nv">public_net</span><span class="w"> </span><span class="p p-Indicator">}</span>

<span class="w">  </span><span class="c1"># 5. Connect IP to Server</span>
<span class="w">  </span><span class="nt">association</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OS::Neutron::FloatingIPAssociation</span>
<span class="w">    </span><span class="nt">properties</span><span class="p">:</span>
<span class="w">      </span><span class="nt">floatingip_id</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_resource</span><span class="p">:</span><span class="w"> </span><span class="nv">my_ip</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">      </span><span class="nt">port_id</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_attr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">web_instance</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">addresses</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_resource</span><span class="p">:</span><span class="w"> </span><span class="nv">app_net</span><span class="w"> </span><span class="p p-Indicator">},</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">port</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="p p-Indicator">}</span>

<span class="nt">outputs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">website_url</span><span class="p">:</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">The public IP</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> get_attr</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">my_ip</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">floating_ip_address</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>

<ol>
<li><strong>Validate syntax</strong>:
    Before deploying, check for typos.
    <code>bash
    openstack orchestration template validate -t deployment.yaml</code>
    <em>If this returns JSON output, your YAML is valid.</em></li>
</ol>
<hr />
<h2 id="part-2-deploying-the-stack">Part 2: Deploying the Stack</h2>
<ol>
<li>
<p><strong>Create the Stack</strong>:
    <code>bash
    openstack stack create -t deployment.yaml --wait lab3-stack</code></p>
<ul>
<li><code>-t</code>: The template file.</li>
<li><code>--wait</code>: Blocks the terminal until the deployment is finished.</li>
</ul>
</li>
<li>
<p><strong>Verify</strong>:
    Once it finishes, check the output to see the IP address.
    <code>bash
    openstack stack show lab3-stack</code>
    Look for the <code>outputs</code> section at the bottom.</p>
</li>
<li>
<p><strong>Test the Server</strong>:
    Open the IP address in your browser. You should see "Welcome to nginx!".</p>
</li>
<li>
<p><strong>Field Report</strong>:</p>
<ul>
<li><strong>Stack Status</strong>: <code>[ ___________________ ]</code> (Should be CREATE_COMPLETE)</li>
<li><strong>Floating IP</strong>: <code>[ ___________________ ]</code></li>
</ul>
</li>
</ol>
<hr />
<h2 id="part-3-the-power-of-updates-declarative">Part 3: The Power of Updates (Declarative)</h2>
<p>This is the most important part of the lab. We will change the requirements and ask Heat to fix it.</p>
<ol>
<li>
<p><strong>Scenario</strong>: Your security manager wants you to <strong>block SSH</strong> (Port 22) and only allow HTTP.</p>
</li>
<li>
<p><strong>Edit the Template</strong>:
    Open <code>deployment.yaml</code>.</p>
<ul>
<li>Locate the <code>web_sg</code> resource.</li>
<li><strong>DELETE</strong> the rule block for port 22.</li>
<li>Save the file.</li>
</ul>
</li>
<li>
<p><strong>Update the Stack</strong>:
    Run the <em>same</em> command, but with <code>update</code>.
    <code>bash
    openstack stack update -t deployment.yaml --wait lab3-stack</code></p>
<blockquote>
<p><strong>Observation</strong>:
*   Did Heat verify everything? <strong>Yes</strong>.
*   Did it destroy the server? <strong>No</strong>.
*   Did it change the IP? <strong>No</strong>.
*   It <em>only</em> removed the security group rule. This is <strong>Idempotency</strong>.</p>
</blockquote>
</li>
<li>
<p><strong>Verify</strong>:
    Try to SSH into the server using the IP from earlier.
    <code>bash
    ssh ubuntu@&lt;IP&gt;</code></p>
<ul>
<li><em>Result</em>: It should <strong>Hang/Timeout</strong> (because the rule is gone).</li>
<li><em>Website</em>: It should still work.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="part-4-cleanup">Part 4: Cleanup</h2>
<p>In Lab 1, cleaning up the script's mess required finding the Instance ID, Floating IP ID, and Security Group ID separately.
With Heat, we treat the stack as a single unit.</p>
<ol>
<li>
<p><strong>Delete the Stack</strong>:
    <code>bash
    openstack stack delete -y lab3-stack</code></p>
</li>
<li>
<p><strong>Verify</strong>:
    <code>bash
    openstack server list
    openstack app_net list</code>
    Everything defined in the template is gone.</p>
</li>
</ol>
<hr />
<h2 id="lab-checkpoint">Lab Checkpoint</h2>
<ul>
<li class="task-list-item"><input type="checkbox" disabled> I have written a valid Heat Template.</li>
<li class="task-list-item"><input type="checkbox" disabled> I have successfully deployed a stack (Server + Net + SG + IP).</li>
<li class="task-list-item"><input type="checkbox" disabled> I have demonstrated a <strong>Stack Update</strong> by modifying the Security Group.</li>
</ul>
<p><strong>Reflection</strong>:</p>
<ul>
<li>Why is <code>stack update</code> safer than manually running commands on a production server?</li>
<li>If we deleted the server manually (<code>openstack server delete</code>) but kept the stack, what would happen if we ran <code>stack update</code>? (Hint: Heat would notice the server is missing and <strong>recreate it</strong>—this is called <em>Self-Healing</em>).</li>
</ul>
<hr />
<p><strong>Instructor Signature</strong>: <strong><em>_</em></strong><strong><em>_</em></strong><strong><em>_</em></strong><strong>
<strong>Date</strong>: <strong><em>_</em></strong><strong><em>_</em></strong><strong><em>_</em></strong></strong></p>
<p><a href="../index.html">← Back to Course Index</a></p>
    </article>
</main>

<!-- Footer -->
<footer class="text-center text-slate-500 dark:text-slate-400 text-sm pb-8">
</footer>

<!-- Progress Tracking -->
<script src="../js/course_logic.js"></script>

</body>
</html>
