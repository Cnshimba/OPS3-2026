
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Week 6 Student Notes</title>
<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                },
                colors: {
                    primary: '#002F6E', // VUT Midnight Blue
                    secondary: '#6c757d',
                    codebg: 'var(--bg-code)', 
                },
                typography: {
                    DEFAULT: {
                        css: {
                            maxWidth: '100%',
                            fontFamily: 'Inter, sans-serif',
                            color: 'var(--text-body)',
                            '--tw-prose-body': 'var(--text-body)',
                            '--tw-prose-headings': 'var(--text-headings)',
                            '--tw-prose-links': 'var(--text-link)',
                            '--tw-prose-bold': 'var(--text-headings)',
                            '--tw-prose-counters': 'var(--text-body)',
                            '--tw-prose-bullets': 'var(--text-body)',
                            '--tw-prose-hr': 'var(--border-color)',
                            '--tw-prose-quotes': 'var(--text-body)',
                            '--tw-prose-code': 'var(--text-code)',
                            '--tw-prose-pre-code': 'var(--text-pre)',
                            '--tw-prose-pre-bg': 'var(--bg-pre)',
                            
                            // Image Sizing Control
                            img: {
                                display: 'block',
                                marginLeft: 'auto',
                                marginRight: 'auto',
                                maxHeight: '500px',
                                width: 'auto',
                                height: 'auto',
                                borderRadius: '0.5rem',
                                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                            },
                            // Links
                            a: {
                                color: 'var(--text-link)',
                                '&:hover': { opacity: '0.8' },
                            },
                            // Inline Code
                            code: {
                                color: 'var(--text-code)',
                                backgroundColor: 'var(--bg-code)',
                                padding: '0.2rem 0.4rem',
                                borderRadius: '0.25rem',
                                fontWeight: '600',
                                border: '1px solid var(--border-code)',
                            },
                            'code::before': { content: '""' },
                            'code::after': { content: '""' },
                            // Code Blocks (Pre)
                            pre: {
                                backgroundColor: 'var(--bg-pre) !important',
                                color: 'var(--text-pre)',
                                padding: '1rem',
                                borderRadius: '0.5rem',
                                border: '1px solid var(--border-pre)',
                            },
                            // Notes/Alerts (Blockquotes)
                            blockquote: {
                                borderLeftColor: '#002F6E',
                                borderLeftWidth: '4px',
                                backgroundColor: 'var(--bg-note)',
                                padding: '1rem',
                                color: 'var(--text-body)',
                                fontSize: '0.9rem', // Smaller text for notes
                                fontStyle: 'italic',
                                quotes: 'none',
                                borderRadius: '0 0.5rem 0.5rem 0',
                            },
                            'blockquote p:first-of-type::before': { content: 'none' },
                            'blockquote p:last-of-type::after': { content: 'none' },
                            // Tables (Restored from First Attempt)
                            table: {
                                width: '100%',
                                marginTop: '2em',
                                marginBottom: '2em',
                                borderCollapse: 'collapse',
                                fontSize: '0.9rem',
                            },
                            'thead th': {
                                backgroundColor: '#f3f4f6', 
                                color: '#1f2937', 
                                fontWeight: '600',
                                padding: '0.75rem',
                                borderBottom: '2px solid #e5e7eb',
                                textAlign: 'left',
                            },
                            'tbody td': {
                                padding: '0.75rem',
                                borderBottom: '1px solid #e5e7eb',
                                verticalAlign: 'top',
                            },
                            'tbody tr:hover': {
                                backgroundColor: '#f9fafb',
                            },
                            
                            // Task Lists (Checkboxes)
                            '.task-list-item': {
                                listStyleType: 'none',
                            },
                            '.task-list-item input[type="checkbox"]': {
                                marginRight: '0.5rem',
                            },

                            thead: {
                                borderBottomWidth: '2px',
                                borderBottomColor: 'var(--border-color)',
                            },
                            'thead th': {
                                color: 'var(--text-headings)',
                                fontWeight: '600',
                                verticalAlign: 'bottom',
                                paddingRight: '0.75em',
                                paddingBottom: '0.75em',
                                paddingLeft: '0.75em',
                                textAlign: 'left',
                            },
                            'tbody tr': {
                                borderBottomWidth: '1px',
                                borderBottomColor: 'var(--border-color)',
                            },
                            'tbody tr:last-child': {
                                borderBottomWidth: '0',
                            },
                            'tbody td': {
                                verticalAlign: 'top',
                                padding: '0.75em',
                            },
                        },
                    },
                },
            },
        },
    }
</script>
<script>
    // Theme Toggle Logic
    document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const iconSun = document.getElementById('icon-sun');
        const iconMoon = document.getElementById('icon-moon');

        // Check local storage or preference
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
            iconSun.classList.remove('hidden');
            iconMoon.classList.add('hidden');
        } else {
            html.classList.remove('dark');
            iconSun.classList.add('hidden');
            iconMoon.classList.remove('hidden');
        }

        themeToggle.addEventListener('click', () => {
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.theme = 'light';
                iconSun.classList.add('hidden');
                iconMoon.classList.remove('hidden');
            } else {
                html.classList.add('dark');
                localStorage.theme = 'dark';
                iconSun.classList.remove('hidden');
                iconMoon.classList.add('hidden');
            }
        });
    });
</script>
<style>
    /* CSS Variables for Theming */
    :root {
        --bg-body: #f8fafc;
        --bg-card: #ffffff;
        --text-body: #334155;
        --text-headings: #0f172a;
        --text-link: #002F6E; /* VUT Blue */
        --border-color: #e2e8f0;
        
        /* Code - Light Mode */
        --bg-code: #f1f5f9;
        --text-code: #d63384;
        --border-code: #e2e8f0;
        
        /* Pre - Light Mode (Github Light) */
        --bg-pre: #f6f8fa;
        --text-pre: #24292e;
        --border-pre: #d0d7de;
        
        /* Note - Light Mode */
        --bg-note: #f8f9fa;
        
        /* Scrollbar */
        --scroll-track: #f1f1f1;
        --scroll-thumb: #888;
    }

    html.dark {
        --bg-body: #0f172a;
        --bg-card: #1e293b;
        --text-body: #cbd5e1;
        --text-headings: #f8fafc;
        --text-link: #60a5fa; /* Blue 400 - Brighter for better contrast */
        --border-color: #334155;
        
        /* Code - Dark Mode */
        --bg-code: #334155;
        --text-code: #f472b6; 
        --border-code: #475569;
        
        /* Pre - Dark Mode (Monokai) */
        --bg-pre: #272822;
        --text-pre: #f8f8f2;
        --border-pre: #464539;
        
        /* Note - Dark Mode */
        --bg-note: #1e293b;
        --scroll-track: #1e293b;
        --scroll-thumb: #475569;
    }

    /* Transition */
    body, article, code, pre, blockquote {
        transition: background-color 0.3s, color 0.3s, border-color 0.3s;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--scroll-track); }
    ::-webkit-scrollbar-thumb { background: var(--scroll-thumb); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
    
    /* Syntax Highlighting - LIGHT MODE (GitHub Light Inspired) */
    .codehilite .hll { background-color: #ffffcc }
    .codehilite .c { color: #6a737d; font-style: italic } /* Comment */
    .codehilite .err { color: #f05240; background-color: #ffeaea } /* Error */
    .codehilite .k { color: #d73a49; font-weight: bold } /* Keyword */
    .codehilite .o { color: #d73a49; font-weight: bold } /* Operator */
    .codehilite .cm { color: #6a737d; font-style: italic } /* Comment.Multiline */
    .codehilite .cp { color: #6a737d; font-weight: bold } /* Comment.Preproc */
    .codehilite .c1 { color: #6a737d; font-style: italic } /* Comment.Single */
    .codehilite .cs { color: #6a737d; font-style: italic } /* Comment.Special */
    .codehilite .gd { color: #d73a49; background-color: #fdd } /* Generic.Deleted */
    .codehilite .ge { font-style: italic } /* Generic.Emph */
    .codehilite .gr { color: #aa0000 } /* Generic.Error */
    .codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
    .codehilite .gi { color: #00a000; background-color: #dfd } /* Generic.Inserted */
    .codehilite .go { color: #888888 } /* Generic.Output */
    .codehilite .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
    .codehilite .gs { font-weight: bold } /* Generic.Strong */
    .codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
    .codehilite .gt { color: #aa0000 } /* Generic.Traceback */
    .codehilite .kc { color: #005cc5; font-weight: bold } /* Keyword.Constant */
    .codehilite .kd { color: #d73a49; font-weight: bold } /* Keyword.Declaration */
    .codehilite .kn { color: #d73a49; font-weight: bold } /* Keyword.Namespace */
    .codehilite .kp { color: #d73a49 } /* Keyword.Pseudo */
    .codehilite .kr { color: #d73a49; font-weight: bold } /* Keyword.Reserved */
    .codehilite .kt { color: #445588; font-weight: bold } /* Keyword.Type */
    .codehilite .m { color: #005cc5 } /* Literal.Number */
    .codehilite .s { color: #032f62 } /* Literal.String */
    .codehilite .na { color: #22863a } /* Name.Attribute */
    .codehilite .nb { color: #005cc5 } /* Name.Builtin */
    .codehilite .nc { color: #6f42c1; font-weight: bold } /* Name.Class */
    .codehilite .no { color: #005cc5 } /* Name.Constant */
    .codehilite .nd { color: #6f42c1; font-weight: bold } /* Name.Decorator */
    .codehilite .ni { color: #800080 } /* Name.Entity */
    .codehilite .ne { color: #990000; font-weight: bold } /* Name.Exception */
    .codehilite .nf { color: #6f42c1; font-weight: bold } /* Name.Function */
    .codehilite .nl { color: #990000; font-weight: bold } /* Name.Label */
    .codehilite .nn { color: #6f42c1; font-weight: bold } /* Name.Namespace */
    .codehilite .nt { color: #22863a } /* Name.Tag */
    .codehilite .nv { color: #e36209 } /* Name.Variable */
    .codehilite .ow { color: #d73a49; font-weight: bold } /* Operator.Word */
    .codehilite .w { color: #bbbbbb } /* Text.Whitespace */
    .codehilite .mf { color: #005cc5 } /* Literal.Number.Float */
    .codehilite .mh { color: #005cc5 } /* Literal.Number.Hex */
    .codehilite .mi { color: #005cc5 } /* Literal.Number.Integer */
    .codehilite .mo { color: #005cc5 } /* Literal.Number.Oct */
    .codehilite .sb { color: #032f62 } /* Literal.String.Backtick */
    .codehilite .sc { color: #032f62 } /* Literal.String.Char */
    .codehilite .sd { color: #032f62 } /* Literal.String.Doc */
    .codehilite .s2 { color: #032f62 } /* Literal.String.Double */
    .codehilite .se { color: #005cc5 } /* Literal.String.Escape */
    .codehilite .sh { color: #032f62 } /* Literal.String.Heredoc */
    .codehilite .si { color: #032f62 } /* Literal.String.Interpol */
    .codehilite .sx { color: #032f62 } /* Literal.String.Other */
    .codehilite .sr { color: #032f62 } /* Literal.String.Regex */
    .codehilite .s1 { color: #032f62 } /* Literal.String.Single */
    .codehilite .ss { color: #005cc5 } /* Literal.String.Symbol */
    .codehilite .bp { color: #005cc5 } /* Name.Builtin.Pseudo */
    .codehilite .vc { color: #e36209 } /* Name.Variable.Class */
    .codehilite .vg { color: #e36209 } /* Name.Variable.Global */
    .codehilite .vi { color: #e36209 } /* Name.Variable.Instance */
    .codehilite .il { color: #005cc5 } /* Literal.Number.Integer.Long */
    
    /* Syntax Highlighting - DARK MODE (Monokai Overrides) */
    html.dark .codehilite .hll { background-color: #49483e }
    html.dark .codehilite .c { color: #75715e } /* Comment */
    html.dark .codehilite .err { color: #960050; background-color: #1e0010 } /* Error */
    html.dark .codehilite .k { color: #66d9ef; font-weight: normal } /* Keyword */
    html.dark .codehilite .l { color: #ae81ff } /* Literal */
    html.dark .codehilite .n { color: #f8f8f2 } /* Name */
    html.dark .codehilite .o { color: #f92672; font-weight: normal } /* Operator */
    html.dark .codehilite .p { color: #f8f8f2 } /* Punctuation */
    html.dark .codehilite .cm { color: #75715e } /* Comment.Multiline */
    html.dark .codehilite .cp { color: #75715e } /* Comment.Preproc */
    html.dark .codehilite .c1 { color: #75715e } /* Comment.Single */
    html.dark .codehilite .cs { color: #75715e } /* Comment.Special */
    html.dark .codehilite .ge { font-style: italic } /* Generic.Emph */
    html.dark .codehilite .gs { font-weight: bold } /* Generic.Strong */
    html.dark .codehilite .kc { color: #66d9ef; font-weight: normal } /* Keyword.Constant */
    html.dark .codehilite .kd { color: #66d9ef; font-weight: normal  } /* Keyword.Declaration */
    html.dark .codehilite .kn { color: #f92672; font-weight: normal  } /* Keyword.Namespace */
    html.dark .codehilite .kp { color: #66d9ef; font-weight: normal  } /* Keyword.Pseudo */
    html.dark .codehilite .kr { color: #66d9ef; font-weight: normal  } /* Keyword.Reserved */
    html.dark .codehilite .kt { color: #66d9ef; font-weight: normal  } /* Keyword.Type */
    html.dark .codehilite .ld { color: #e6db74 } /* Literal.Date */
    html.dark .codehilite .m { color: #ae81ff } /* Literal.Number */
    html.dark .codehilite .s { color: #e6db74 } /* Literal.String */
    html.dark .codehilite .na { color: #a6e22e } /* Name.Attribute */
    html.dark .codehilite .nb { color: #f8f8f2 } /* Name.Builtin */
    html.dark .codehilite .nc { color: #a6e22e } /* Name.Class */
    html.dark .codehilite .no { color: #66d9ef } /* Name.Constant */
    html.dark .codehilite .nd { color: #a6e22e } /* Name.Decorator */
    html.dark .codehilite .ni { color: #f8f8f2 } /* Name.Entity */
    html.dark .codehilite .ne { color: #a6e22e } /* Name.Exception */
    html.dark .codehilite .nf { color: #a6e22e } /* Name.Function */
    html.dark .codehilite .nl { color: #f8f8f2 } /* Name.Label */
    html.dark .codehilite .nn { color: #f8f8f2 } /* Name.Namespace */
    html.dark .codehilite .nx { color: #a6e22e } /* Name.Other */
    html.dark .codehilite .py { color: #f8f8f2 } /* Name.Property */
    html.dark .codehilite .nt { color: #f92672 } /* Name.Tag */
    html.dark .codehilite .nv { color: #f8f8f2 } /* Name.Variable */
    html.dark .codehilite .ow { color: #f92672; font-weight: normal  } /* Operator.Word */
    html.dark .codehilite .w { color: #f8f8f2 } /* Text.Whitespace */
    html.dark .codehilite .mb { color: #ae81ff } /* Literal.Number.Bin */
    html.dark .codehilite .mf { color: #ae81ff } /* Literal.Number.Float */
    html.dark .codehilite .mh { color: #ae81ff } /* Literal.Number.Hex */
    html.dark .codehilite .mi { color: #ae81ff } /* Literal.Number.Integer */
    html.dark .codehilite .mo { color: #ae81ff } /* Literal.Number.Oct */
    html.dark .codehilite .sb { color: #e6db74 } /* Literal.String.Backtick */
    html.dark .codehilite .sc { color: #e6db74 } /* Literal.String.Char */
    html.dark .codehilite .sd { color: #e6db74 } /* Literal.String.Doc */
    html.dark .codehilite .s2 { color: #e6db74 } /* Literal.String.Double */
    html.dark .codehilite .se { color: #ae81ff } /* Literal.String.Escape */
    html.dark .codehilite .sh { color: #e6db74 } /* Literal.String.Heredoc */
    html.dark .codehilite .si { color: #e6db74 } /* Literal.String.Interpol */
    html.dark .codehilite .sx { color: #e6db74 } /* Literal.String.Other */
    html.dark .codehilite .sr { color: #e6db74 } /* Literal.String.Regex */
    html.dark .codehilite .s1 { color: #e6db74 } /* Literal.String.Single */
    html.dark .codehilite .ss { color: #ae81ff } /* Literal.String.Symbol */
</style>
<style>
        /* Glossary Tooltip Styles */
        .glossary-term {
            color: #c9984a;
            border-bottom: 2px dotted #c9984a;
            cursor: help;
            position: relative;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .glossary-term:hover {
            color: #ffffff;
            border-bottom-color: #ffffff;
        }
        
        .glossary-tooltip {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            z-index: 1000;
            background: linear-gradient(135deg, #1e3a5f 0%, #142a46 100%);
            color: #ffffff;
            padding: 12px 16px;
            border-radius: 8px;
            border: 2px solid #c9984a;
            font-size: 14px;
            line-height: 1.5;
            max-width: 300px;
            width: max-content;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            transition: opacity 0.3s, visibility 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .glossary-tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -8px;
            border-width: 8px;
            border-style: solid;
            border-color: #c9984a transparent transparent transparent;
        }
        
        .glossary-term:hover .glossary-tooltip {
            visibility: visible;
            opacity: 1;
        }
        </style></head>
<body class="bg-[var(--bg-body)] text-[var(--text-body)] pt-20 transition-colors duration-300">
<!-- Navigation -->
<nav class="fixed top-0 left-0 right-0 bg-[var(--bg-card)]/90 backdrop-blur-md shadow-sm z-50 border-b border-[var(--border-color)] transition-colors duration-300">
<div class="container mx-auto px-4 max-w-5xl h-16 flex items-center justify-between">
<a class="flex items-center space-x-3 text-[var(--text-headings)] hover:text-blue-600 transition-colors no-underline" href="../index.html">
<img alt="VUT Logo" class="h-12 w-auto object-contain" src="../ops3_logo.png"/>
<div class="flex flex-col">
<span class="font-bold text-lg leading-tight tracking-tight text-primary dark:text-sky-400 hidden sm:block">Operating Systems 3</span>
<span class="text-xs text-slate-500 dark:text-slate-400 font-medium hidden sm:block">Virtualisation &amp; Cloud Technologies</span>
<span class="font-bold text-lg tracking-tight sm:hidden">OPS3</span>
</div>
</a>
<div class="flex items-center space-x-6">
<a class="text-sm font-medium text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-sky-400 transition-colors no-underline" href="../index.html">
                Course Home
            </a>
<!-- Theme Toggle Button -->
<button class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" id="theme-toggle">
<!-- Sun Icon -->
<svg class="w-5 h-5 text-yellow-500 hidden" fill="none" id="icon-sun" stroke="currentColor" viewbox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
<!-- Moon Icon -->
<svg class="w-5 h-5 text-slate-500" fill="none" id="icon-moon" stroke="currentColor" viewbox="0 0 24 24"><path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
</button>
</div>
</div>
</nav>
<!-- Main Content -->
<main class="container mx-auto px-4 max-w-5xl mb-12">
<article class="prose lg:prose-lg max-w-none bg-[var(--bg-card)] p-6 md:p-12 rounded-xl shadow-sm border border-[var(--border-color)] transition-colors duration-300">
<p><a href="../index.html">← Back to Course Index</a></p>
<div class="flex items-stretch bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm mb-8 overflow-hidden">
<div class="w-40 flex-shrink-0 flex items-center justify-center bg-white dark:bg-gray-900">
<img alt="Cluster and HA Icon" class="h-full w-full object-cover" src="images/week_6_icon.png"/>
</div>
<div class="flex-1 flex flex-col items-center justify-center p-6">
<h1 class="text-2xl font-bold text-primary dark:text-sky-400 m-0 text-center">Cluster and High Availability</h1>
<span class="text-lg font-medium text-gray-500 dark:text-gray-400 mt-1">Student Notes</span>
</div>
</div>
<p><strong>Course</strong>: Computer Systems Engineering
<strong>Module</strong>: Operating Systems 3 (Virtualisation &amp; Cloud Technologies)
<strong>Topic</strong>: <a class="glossary-term" href="glossary.html#Cluster">Cluster<span class="glossary-tooltip">Group of servers working together</span></a> and <a class="glossary-term" href="glossary.html#High-Availability">High Availability<span class="glossary-tooltip">System design for minimal downtime (99.9%+ uptime)</span></a>
<strong>Estimated Reading Time</strong>: 30 Minutes</p>
<blockquote>
<p>[!TIP]
<strong>How to succeed in this week</strong>:
Clustering is a complex topic where "split-brain" and "<a class="glossary-term" href="glossary.html#Quorum">quorum<span class="glossary-tooltip">Minimum nodes needed for cluster to function</span></a> to function <span class="glossary-icon"></span>" are more than just buzzwords—they determine if your data survives a failure. We strongly recommend you strictly follow the lab exercises to build a 3-node <a class="glossary-term" href="glossary.html#Cluster">cluster<span class="glossary-tooltip">Group of servers working together</span></a>. Seeing a node fail and recover automatically in your lab will make these abstract concepts concrete.</p>
</blockquote>
<hr/>
<h2 id="welcome-to-week-6">Welcome to Week 6!</h2>
<p>Up until now, our journey has focused on singular, standalone "pet" servers. We have treated each Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> node as an individual entity: if it fails, the virtual machines hosted on it fail with it, requiring manual intervention to restore service. This model is acceptable for home labs but insufficient for enterprise environments where uptime is critical. In a true Cloud Environment, servers are treated as "cattle"—interchangeable resources where the failure of one unit does not disrupt the overall system.</p>
<p>This week, we transition from standalone virtualization to <strong>Clustering</strong>. We will link multiple Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> nodes together to form a unified datacenter. We will explore the mechanics of the <strong>Quorum to function <span class="glossary-icon"></span></strong> (the decision-making algorithm that maintains cluster integrity) and implement <strong>High Availability (HA - System design for minimal downtime <span class="glossary-icon"></span>)</strong>, ensuring that our workloads become resilient to physical hardware failure.</p>
<hr/>
<h2 id="what-youll-learn-this-week">What You'll Learn This Week</h2>
<ul>
<li><strong>Cluster Management:</strong> We will master <code>pvecm</code>, the command-line tool for creating, joining, and managing cluster nodes.</li>
<li><strong>The Voting Algorithm:</strong> We will deconstruct the mathematical logic behind Quorum to function <span class="glossary-icon"></span> and how it prevents the catastrophic "Split Brain" scenario.</li>
<li><strong>Corosync engine for group communication <span class="glossary-icon"></span> Engine:</strong> We will examine the low-latency communication protocol that acts as the cluster's heartbeat.</li>
<li><strong>High Availability (HA - System design for minimal downtime <span class="glossary-icon"></span>):</strong> We will configure Watchdogs and Fencing nodes <span class="glossary-icon"></span> to automate the recovery of VMs during node failures.</li>
<li><strong>Live Migration - A software-based emulation of a physical computer <span class="glossary-icon"></span> between hosts without downtime <span class="glossary-icon"></span>:</strong> We will perform the magic of moving running workloads between servers without dropping a single network packet.</li>
</ul>
<hr/>
<h1 id="part-1-the-cluster-stack">Part 1: The Cluster Stack</h1>
<p>At the heart of Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> VE's clustering capability lies the <strong>Corosync engine for group communication <span class="glossary-icon"></span> Cluster Engine</strong>. This crucial component provides the reliable, low-latency communication layer that allows nodes to share state. Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> Cluster Manager (<code>pvecm</code>) wraps this complex engine into a user-friendly toolset.</p>
<p><img alt="Proxmox Cluster Architecture" src="images/promox_cluster_architecture.png"/>
<em>Figure 1: Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> Cluster Architecture - Nodes communicating via Corosync engine for group communication <span class="glossary-icon"></span> Ring X on a dedicated low-latency network to maintain shared state</em></p>
<h2 id="1-creating-a-cluster">1. Creating a Cluster</h2>
<p>While the web interface provides a convenient way to create clusters, understanding the Command Line Interface (CLI) is essential for troubleshooting and automation. The CLI exposes the underlying steps of key generation and configuration distribution.</p>
<h3 id="11-initialization">1.1 Initialization</h3>
<p>When you initialize a cluster, Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> performs several critical actions. It generates a cryptographic key (<code>/etc/corosync/authkey</code>) appearing to secure communication and creates the central configuration database (<code>/etc/pve/corosync.conf</code>). This database is essentially the "source of truth" for the entire cluster.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create a cluster named 'Education-Cloud'</span>
pvecm<span class="w"> </span>create<span class="w"> </span>Education-Cloud

<span class="c1"># Verify status to confirm the local node determines it is now part of a cluster</span>
pvecm<span class="w"> </span>status
</code></pre></div>
<h3 id="12-joining-a-node">1.2 Joining a Node</h3>
<p>Adding a second server is a "join" operation, not a creation operation. You instruct the new node to connect to the existing ring. The new node authenticates using the root password or an explicit join token, downloads the cluster keys and configuration files, and restarts its local services to synchronize with the quorum to function <span class="glossary-icon"></span>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run this on Node 2</span>
pvecm<span class="w"> </span>add<span class="w"> </span><span class="m">192</span>.168.1.10<span class="w">  </span><span class="c1"># IP of Node 1</span>
</code></pre></div>
<p><strong>Crucial Requirement</strong>: For a cluster to function correctly, every node must have a unique Hostname and a persistent Static IP address. If an IP address changes after the cluster is formed, Corosync engine for group communication <span class="glossary-icon"></span> communication will break, causing the node to lose quorum to function <span class="glossary-icon"></span> and effectively disconnecting it from the datacenter.</p>
<h3 id="section-1-checkpoint">Section 1 Checkpoint</h3>
<p><strong>Summary</strong>:</p>
<ul>
<li><strong>pvecm</strong> is the primary command-line tool for managing the cluster lifecycle, wrapping the underlying Corosync engine for group communication <span class="glossary-icon"></span> engine.</li>
<li><strong>Cluster Requirements</strong> are strict: nodes must have unique hostnames, static network configurations, and a reliable low-latency network connection.</li>
<li><strong>Joining</strong> involves a node authenticating to an existing cluster leader to download shared keys and configuration state.</li>
</ul>
<p><strong>Reflection</strong>:</p>
<ul>
<li>Why does Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> use SSH keys for cluster communication alongside Corosync engine for group communication <span class="glossary-icon"></span> keys?</li>
<li>What is the impact on the cluster configuration file <code>/etc/pve/corosync.conf</code> if you change a node's IP address without updating it?</li>
</ul>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://pve.proxmox.com/wiki/Cluster_Manager">Proxmox VE Cluster Manager</a></li>
</ul>
<hr/>
<h2 id="2-quorum-the-rule-of-majority-algorithm">2. Quorum to function <span class="glossary-icon"></span>: The Rule of Majority Algorithm</h2>
<p>The most critical safety mechanism in any distributed system is <strong>Quorum to function <span class="glossary-icon"></span></strong>. In the context of Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span>, Quorum to function <span class="glossary-icon"></span> refers to the minimum number of votes required for the cluster to be considered "functional." This ensures that if the cluster fragments into disconnected pieces, only one piece—the majority—is allowed to modify state. This maintains data consistency and prevents divergent histories.</p>
<p><img alt="Quorum Voting Logic" src="images/quorum_voting_logic.png"/>
<em>Figure 2: Quorum to function <span class="glossary-icon"></span> Voting Logic - How the formula (Total/2)+1 determines the operational status of a cluster segment</em></p>
<h3 id="21-the-split-brain-condition">2.1 The Split Brain Condition</h3>
<p>"Split Brain" is a catastrophic failure state in a clustered environment where network communication is severed between nodes, yet the nodes themselves remain operational.</p>
<p>Consider a two-node cluster (Node A and Node B) where the heartbeat connection fails:</p>
<ul>
<li><strong>The Divergence</strong>: Node A cannot see Node B and assumes Node B has failed. Simultaneously, Node B assumes Node A has failed.</li>
<li><strong>The Conflict</strong>: Both nodes promote themselves to "Master" status and attempt to take ownership of the same resources (e.g., VM - A software-based emulation of a physical computer <span class="glossary-icon"></span> ID 100).</li>
<li><strong>The Consequence</strong>: Both nodes mount the same shared storage volume and attempt to write data concurrently.</li>
<li><strong>The Result</strong>: Since they are unaware of each other's write operations, they overwrite each other's filesystem journals, leading to irreversible data corruption within milliseconds.</li>
</ul>
<p><img alt="Split Brain Scenario" src="images/split_brain_scenario.png"/>
<em>Figure 3: Split Brain Scenario - A network cut leads to dual active masters ensuring data corruption without quorum to function <span class="glossary-icon"></span> logic</em></p>
<h3 id="22-quorum-logic">2.2 Quorum to function <span class="glossary-icon"></span> Logic</h3>
<p>To prevent Split Brain, the Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> Cluster Manager (pvecm) enforces a strictly democratic requirement: operations can only proceed if a strict majority of nodes are present. The formula for this is <code>(Total Votes / 2) + 1</code>.</p>
<p>In a <strong>2-Node Cluster</strong>, there are 2 total votes. The majority needed is <code>(2/2) + 1 = 2</code>. This implies that if a single node fails, the survivor has only 1 vote. Since 1 is less than 2, Quorum to function <span class="glossary-icon"></span> is lost. The surviving node essentially "locks down," forcing the filesystem into Read-Only mode to prevent any possibility of corruption.</p>
<p>In a <strong>3-Node Cluster</strong>, there are 3 total votes. The majority needed is <code>(3/2) + 1 = 2.5</code> (which rounds down to integer 2). If one node fails, the remaining two nodes have 2 votes. Since 2 equals 2, Quorum to function <span class="glossary-icon"></span> is maintained, and the cluster remains fully operational. This highlights the architectural best practice of always designing clusters with an <strong>ODD</strong> number of nodes (3, 5, 7) to allow for reliable tie-breaking.</p>
<h3 id="section-2-checkpoint">Section 2 Checkpoint</h3>
<p><strong>Summary</strong>:</p>
<ul>
<li><strong>Quorum to function <span class="glossary-icon"></span></strong> enforces the "Rule of Majority" using the formula <code>(Total/2)+1</code> to ensure only one part of a partitioned cluster remains active.</li>
<li><strong>Split Brain</strong> occurs when disconnected nodes both attempt to become Master, leading to guaranteed data corruption.</li>
<li><strong>Safety Mechanism</strong>: If Quorum to function <span class="glossary-icon"></span> is lost, the cluster automatically locks down to Read-Only mode to preserve data integrity.</li>
</ul>
<p><strong>Reflection</strong>:</p>
<ul>
<li>Why is a 2-node cluster considered "dangerous" without an external vote (QDevice)?</li>
<li>Does a "Majority" mean 51% (more than half) or exactly half?</li>
</ul>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="http://corosync.github.io/corosync/">Corosync Project</a></li>
</ul>
<hr/>
<h2 id="3-high-availability-ha-manager">3. High Availability (HA - System design for minimal downtime <span class="glossary-icon"></span>) Manager</h2>
<p>Clustering provides a unified management interface, but it does not automatically guarantee uptime. If a node fails in a standard cluster, its VMs simply turn off. <strong>High Availability (HA - System design for minimal downtime <span class="glossary-icon"></span>)</strong> is the automated subsystem designed to solve this problem. Its primary function is to detect physical hardware failures (such as power loss or kernel panic) and automatically restart the affected Virtual Machines on the remaining healthy nodes. This capability minimizes downtime from hours (waiting for an administrator to intervene) to minutes (automatic recovery).</p>
<p><img alt="HA Manager Architecture" src="images/ha_manager_architecture.png"/>
<em>Figure 4: HA - System design for minimal downtime <span class="glossary-icon"></span> Manager Architecture - The Master CRM orchestrating Local LRMs to maintain service availability</em></p>
<h3 id="31-architecture-components">3.1 Architecture Components</h3>
<p>The HA - System design for minimal downtime <span class="glossary-icon"></span> system is composed of two primary agents that work in tandem to maintain service availability.</p>
<h4 id="311-ha-resource-manager-crm">3.1.1 HA - System design for minimal downtime <span class="glossary-icon"></span> Resource Manager (CRM)</h4>
<p>The <strong>Cluster Resource Manager (<code>pve-ha-crm</code>)</strong> acts as the "Cluster Manager" or the "Boss." It runs as a single active instance on the current master node. Its job is to maintain the state of the cluster and make high-level decisions about where services should live. If the node running the active CRM fails, the cluster automatically elects a new master to take over this role.</p>
<h4 id="312-ha-local-resource-manager-lrm">3.1.2 HA - System design for minimal downtime <span class="glossary-icon"></span> Local Resource Manager (LRM)</h4>
<p>The <strong>Local Resource Manager (<code>pve-ha-lrm</code>)</strong> acts as the "Worker." An instance runs on every single node in the cluster. It receives orders from the CRM to start or stop services and reports the status of local resources back to the master. It is responsible for the actual execution of service management commands on the local hypervisor.</p>
<h3 id="32-fencing-mechanism">3.2 Fencing nodes <span class="glossary-icon"></span> Mechanism</h3>
<p>The HA - System design for minimal downtime <span class="glossary-icon"></span> mechanism relies on absolute certainty. Before the cluster can steal VMs from a non-responsive node, it must be 100% sure that the node is truly dead.</p>
<h4 id="321-the-split-brain-problem">3.2.1 The Split-Brain Problem</h4>
<p>If Node A stops responding to heartbeats, Node B cannot know if Node A has crashed or if just the network cable was unplugged. If Node B starts Node A's VMs while Node A is still running them, both nodes would attempt to write to the same virtual disks simultaneously, guaranteeing severe data corruption.</p>
<h4 id="322-the-stonith-solution">3.2.2 The STONITH Solution</h4>
<p>To solve this, we use <strong>Fencing nodes <span class="glossary-icon"></span></strong>, often referred to by the acronym <strong>STONITH</strong> (Shoot The Other Node In The Head). Upon detecting a failure, the cluster issues a command to a physical hardware device (like an IPMI controller or a Smart PDU) to physically cut power to the faulty node. This guarantees the node is dead. Only after this confirmation does the cluster restart the VMs on healthy nodes.</p>
<p><img alt="Fencing / STONITH Process" src="images/fencing_stonith_process.png"/>
<em>Figure 5: The Fencing nodes <span class="glossary-icon"></span> Process - How the cluster physically isolates a failed node before recovering its workloads</em></p>
<h3 id="section-3-checkpoint">Section 3 Checkpoint</h3>
<p><strong>Summary</strong>:</p>
<ul>
<li><strong>High Availability (HA - System design for minimal downtime <span class="glossary-icon"></span>)</strong> automates the recovery of services by restarting VMs on healthy nodes after a hardware failure.</li>
<li><strong>CRM and LRM</strong> act as the "Manager" and "Worker" services, respectively, to orchestrate the monitoring and recovery process.</li>
<li><strong>Fencing nodes <span class="glossary-icon"></span> (STONITH)</strong> is the essential safety mechanism that physically powers off a non-responsive node to prevent Split Brain before recovery begins.</li>
</ul>
<p><strong>Reflection</strong>:</p>
<ul>
<li>Why is Fencing nodes <span class="glossary-icon"></span> (STONITH) safer than just assuming a silent node is down?</li>
<li>Can you have High Availability without Shared Storage? (Consider the implications of ZFS Replication).</li>
</ul>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://pve.proxmox.com/wiki/High_Availability_Cluster#pve_ha_manager_simulator">Proxmox HA Simulator</a></li>
</ul>
<hr/>
<h1 id="part-2-cli-operations">Part 2: CLI Operations</h1>
<h2 id="4-troubleshooting-the-cluster">4. Troubleshooting the Cluster</h2>
<p>When cluster issues arise—typically indicated by red or gray nodes in the GUI—the web interface often lacks sufficient detail to diagnose the root cause. In these scenarios, the Command Line Interface becomes the primary diagnostic tool.</p>
<p><img alt="Cluster Troubleshooting Flow" src="images/cluster_troubleshooting_flow.png"/>
<em>Figure 6: Cluster Troubleshooting Flowchart - Decision tree for diagnosing Quorum to function <span class="glossary-icon"></span>, Corosync engine for group communication <span class="glossary-icon"></span>, and Network issues</em></p>
<h3 id="41-check-quorum">4.1 Check Quorum to function <span class="glossary-icon"></span></h3>
<p>The first step in any cluster diagnosis is to verify the voting state. Run <code>pvecm status</code> to see the cluster's health from the perspective of the local node. Key fields to observe are <code>Votes</code> (number of nodes currently active) and <code>Quorate</code>. If <code>Quorate</code> is <strong>No</strong>, the cluster has lost its majority and will block any changes to the configuration database (<code>pmxcfs</code>) to prevent split-brain, effectively locking the cluster into a read-only mode.</p>
<div class="codehilite"><pre><span></span><code>pvecm<span class="w"> </span>status
</code></pre></div>
<h3 id="42-check-corosync">4.2 Check Corosync engine for group communication <span class="glossary-icon"></span></h3>
<p>If nodes are not syncing but the network appears up, the issue often lies with Corosync engine for group communication <span class="glossary-icon"></span> latency. Use <code>systemctl status corosync</code> to check the service health. The logs will reveal if the "token retransmit time" is being exceeded. Corosync engine for group communication <span class="glossary-icon"></span> requires extremely low latency (typically &lt; 2ms) to function correctly. High latency links, such as Wi-Fi or saturated 1Gbps uplinks during backups, often cause Corosync engine for group communication <span class="glossary-icon"></span> to drop packets and declare nodes dead falsely.</p>
<div class="codehilite"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>corosync
</code></pre></div>
<h3 id="43-force-quorum-emergency-only">4.3 Force Quorum to function <span class="glossary-icon"></span> (Emergency Only)</h3>
<p>In a catastrophic scenario where you have a 2-node cluster and one node permanently fails, the survivor will lose quorum to function <span class="glossary-icon"></span> (1 vote &lt; 2 required). To recover management capability on the survivor, you can artificially lower the expected vote count.</p>
<div class="codehilite"><pre><span></span><code>pvecm<span class="w"> </span>expected<span class="w"> </span><span class="m">1</span>
</code></pre></div>
<p><strong>Warning</strong>: This command tells the survivor, "Pretend we only expected 1 vote." This allows it to become quorate alone. You must <strong>only</strong> do this if you are absolutely certain the other node is dead. If the other node comes back online while this is active, you will cause a Split Brain scenario.</p>
<h3 id="section-4-checkpoint">Section 4 Checkpoint</h3>
<p><strong>Summary</strong>:</p>
<ul>
<li><strong><code>pvecm status</code></strong> is the primary diagnostic tool for assessing voting health and determining if the cluster is Quorate.</li>
<li><strong>Corosync engine for group communication <span class="glossary-icon"></span> Latency</strong> is the most common cause of instability; high latency triggers false failure detection.</li>
<li><strong>Forcing Quorum to function <span class="glossary-icon"></span> (<code>expected 1</code>)</strong> is a destructive emergency measure to recover a surviving node in a broken cluster.</li>
</ul>
<p><strong>Reflection</strong>:</p>
<ul>
<li>Why is latency (Ping time) so critical for Corosync engine for group communication <span class="glossary-icon"></span> compared to bandwidth?</li>
<li>What does "Quorate: No" actually mean for your ability to start, stop, or migrate VMs?</li>
</ul>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://clusterlabs.org/">Clusterlabs Troubleshooting</a></li>
</ul>
<hr/>
<h2 id="5-live-migration-cli">5. Live Migration - A software-based emulation of a physical computer <span class="glossary-icon"></span> between hosts without downtime <span class="glossary-icon"></span> CLI</h2>
<p><strong>Live Migration - A software-based emulation of a physical computer <span class="glossary-icon"></span> between hosts without downtime <span class="glossary-icon"></span></strong> is the ability to move a running Virtual Machine from one physical node to another with <strong>zero downtime</strong>. It works by copying the VM - A software-based emulation of a physical computer <span class="glossary-icon"></span>'s active RAM state over the network to the destination node. Once the memory is synchronized, the hypervisor pauses the VM - A software-based emulation of a physical computer <span class="glossary-icon"></span> on the source node for a fraction of a second, transfers the final CPU state, and resumes execution on the destination node. To the user, this transition is seamless—network connections remain active, and applications continue running without interruption.</p>
<p><img alt="Live Migration Workflow" src="images/live_migration_workflow.png"/>
<em>Figure 7: Live Migration - A software-based emulation of a physical computer <span class="glossary-icon"></span> between hosts without downtime <span class="glossary-icon"></span> Workflow - Iterative RAM copy followed by atomic switchover for zero-downtime maintenance</em></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># General Syntax: qm migrate &lt;VMID&gt; &lt;TargetNode&gt; [OPTIONS]</span>
</code></pre></div>
<p>To perform this manually via the CLI:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Migrate VM - A software-based emulation of a physical computer </span><span class="glossary-icon"></span> 100 to Node named 'pve2'
<span class="c1"># --online: Keep it running (True Live Migration - A software-based emulation of a physical computer </span><span class="glossary-icon"></span> between hosts without downtime <span class="glossary-icon"></span>)
<span class="c1"># --with-local-disks: Move the storage (disk image) too using storage migration</span>
qm<span class="w"> </span>migrate<span class="w"> </span><span class="m">100</span><span class="w"> </span>pve2<span class="w"> </span>--online<span class="w"> </span>--with-local-disks
</code></pre></div>
<h3 id="section-5-checkpoint">Section 5 Checkpoint</h3>
<p><strong>Summary</strong>:</p>
<ul>
<li><strong>Live Migration - A software-based emulation of a physical computer <span class="glossary-icon"></span> between hosts without downtime <span class="glossary-icon"></span></strong> moves active RAM state between nodes, allowing hardware maintenance without service interruption.</li>
<li><strong>--online</strong> ensures the VM - A software-based emulation of a physical computer <span class="glossary-icon"></span> remains responsive during the transfer; without it, the VM - A software-based emulation of a physical computer <span class="glossary-icon"></span> would hibernate and resume (offline migration).</li>
<li><strong>--with-local-disks</strong> enables migrations even without shared storage by copying the disk image alongside the RAM, though this takes significantly longer.</li>
</ul>
<p><strong>Reflection</strong>:</p>
<ul>
<li>What happens to the VM - A software-based emulation of a physical computer <span class="glossary-icon"></span> if the network cable is unplugged <em>during</em> the RAM copy phase of a migration?</li>
<li>Why must the CPU Type often be set to <code>kvm64</code> or <code>host</code> model carefully in heterogeneous clusters?</li>
</ul>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://www.qemu.org/docs/master/system/migration.html">QEMU Migration Documentation</a></li>
</ul>
<hr/>
<h1 id="part-3-cluster-storage-backups">Part 3: Cluster Storage &amp; Backups</h1>
<h2 id="6-enterprise-shared-storage-architectures">6. Enterprise Shared Storage Architectures</h2>
<h3 id="61-distributed-storage-ceph-advanced">6.1 Distributed Storage: Ceph (Advanced)</h3>
<p>While ZFS is the gold standard for <em>local</em> storage, modern data centers often span multiple servers. <strong>Ceph</strong> is a massively scalable, distributed, self-healing file system that runs across a cluster of Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> nodes.</p>
<p><strong>6.1.1 Architecture Components</strong>
Ceph is not just software; it is a living ecosystem made of daemons:</p>
<ul>
<li><strong>OSD (Object Storage Daemon)</strong>: The workhorse. One OSD runs per physical disk. It handles reading, writing, and replicating data.</li>
<li><strong>MON (Monitor)</strong>: The brain. It maintains the "Cluster Map"—the master list of which nodes are alive and where data lives. You usually need at least 3 MONs for quorum to function <span class="glossary-icon"></span>.</li>
<li><strong>MGR (Manager)</strong>: Collects metrics and state for the GUI dashboard.</li>
</ul>
<p><strong>6.1.2 Implementation in Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> (HCI)</strong>
Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> VE is unique because it integrates Ceph directly into the hypervisor (Hyper-Converged Infrastructure). You do not need external storage servers. The architecture diagram below shows how OSDs, MONs, and MGRs work together across a Ceph cluster:</p>
<p><img alt="Ceph Distributed Storage Architecture" src="../Week%204%20-%20Storage%20and%20Backup/images/ceph_arch.png"/>
<em>Figure 8: Ceph Distributed Storage - OSDs manage disks, MONs maintain cluster maps, and MGRs collect metrics across multiple nodes</em></p>
<ol>
<li><strong>Hardware Requirements</strong>: To be viable, you need at least <strong>3 Nodes</strong> (for a 2/3 replica quorum to function <span class="glossary-icon"></span>) and a <strong>10GbE+ Dedicated Network</strong> (re-balancing data consumes massive bandwidth).</li>
<li><strong>The "Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> Way"</strong>: You don't edit config files manually. You use the Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> Web GUI -&gt; Datacenter -&gt; Ceph to install packages, initialize the network, and create OSDs.</li>
<li><strong>Self-Healing</strong>: If a drive fails, Ceph detects the missing "Placement Groups" (PGs) and automatically re-replicates that data to other OSDs to restore full health.</li>
</ol>
<h3 id="62-external-shared-storage-san-nas">6.2 External Shared Storage (SAN &amp; NAS)</h3>
<p>While Ceph is great for internal storage, many enterprises already have massive external storage arrays (SANs). Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> connects to these using standard protocols.</p>
<ul>
<li><strong>Network Attached Storage (NAS)</strong>: Uses <strong>NFS</strong> or <strong>SMB</strong>. The storage array manages the filesystem. Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> simply mounts a folder. It's easy, but effectively "Serial" (files are locked individually).</li>
<li><strong>Storage Area Network (SAN)</strong>: Uses <strong>iSCSI</strong> or <strong>Fibre Channel</strong>. Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> sees a raw block device over the network.</li>
<li><strong>Parallel / Cluster File Systems</strong>: To allow multiple Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> nodes to mount the <em>same</em> SAN LUN simultaneously and write to it without corrupting data, we use a <strong>Clustered File System</strong> like <strong>GFS2</strong> (Global File System 2) or <strong>OCFS2</strong>.<ul>
<li><strong>Locking</strong>: These systems use a specialized Distributed Lock Manager (DLM) to ensure that if Node A is writing to a file, Node B knows about it instantly.</li>
</ul>
</li>
<li><strong>LVM-Shared</strong>: Alternatively, Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> often uses <strong>LVM</strong> on top of iSCSI in "Shared Mode" to manage raw disk volumes for VMs without a full filesystem layer.</li>
</ul>
<h3 id="section-6-checkpoint">Section 6 Checkpoint</h3>
<p><strong>Summary</strong>:</p>
<ul>
<li><strong>Ceph</strong> (HCI): Distributed, self-healing storage on compute nodes (3+ nodes req).</li>
<li><strong>SAN/NAS</strong>: External storage arrays. Block (iSCSI/FC) vs File (NFS).</li>
<li><strong>Cluster FS</strong>: GFS2/OCFS2 needed for simultaneous shared writes.</li>
</ul>
<p><strong>Reflection</strong>:</p>
<ul>
<li>Why is a 10GbE network mandatory for Ceph?</li>
<li>What happens if two servers write to a standard ext4 non-clustered disk at the same time?</li>
</ul>
<p><strong>Resources</strong>:</p>
<ul>
<li><a href="https://docs.ceph.com/en/latest/start/intro/">Ceph Intro</a></li>
</ul>
<hr/>
<h2 id="7-proxmox-backups-vzdump">7. Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> Backups (VZDump)</h2>
<p>One of the most persistent dangerous misconceptions in cloud infrastructure is equating a <strong>Snapshot - A software-based emulation of a physical computer <span class="glossary-icon"></span> state for rollback <span class="glossary-icon"></span></strong> with a <strong>Backup</strong>.</p>
<h3 id="71-backups-vzdump-vs-snapshots">7.1 Backups (VZDump) vs Snapshots</h3>
<ul>
<li><strong>Snapshot - A software-based emulation of a physical computer <span class="glossary-icon"></span> state for rollback <span class="glossary-icon"></span></strong>: A point-in-time "difference file" linked to the original disk. Dependent.</li>
<li><strong>Backup (VZDump)</strong>: A comprehensive, independent archive (config + compressed disk data, e.g., <code>.vma.zst</code>). It can be moved offsite for disaster recovery.</li>
</ul>
<p><img alt="Snapshot vs. Backup - Understanding the Difference" src="../Week%204%20-%20Storage%20and%20Backup/images/snapshot_backup.png"/>
<em>Figure 9: Snapshot - A software-based emulation of a physical computer <span class="glossary-icon"></span> state for rollback <span class="glossary-icon"></span> vs. Backup - Snapshots are dependent save points for testing; Backups are independent archives for disaster recovery</em></p>
<h3 id="72-proxmox-backup-modes">7.2 Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> Backup Modes</h3>
<p>When performing a backup, the state of the VM - A software-based emulation of a physical computer <span class="glossary-icon"></span> determines the consistency of the data.</p>
<p><img alt="Proxmox Backup Modes - Trade-offs and Use Cases" src="../Week%204%20-%20Storage%20and%20Backup/images/backup_modes.png"/>
<em>Figure 10: Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> Backup Modes - Live (Snapshot - A software-based emulation of a physical computer <span class="glossary-icon"></span> state for rollback <span class="glossary-icon"></span>), Suspend (Frozen), and Stop (Consistent) modes balance uptime vs. data consistency</em></p>
<ol>
<li><strong>Snapshot - A software-based emulation of a physical computer <span class="glossary-icon"></span> state for rollback <span class="glossary-icon"></span> Mode (Live)</strong>: No downtime. Uses QEMU - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> for virtualization <span class="glossary-icon"></span> to pause writes for a microsecond. Ideal for production.</li>
<li><strong>Suspend Mode</strong>: Brief pause. Good for consistency but disrupts services.</li>
<li><strong>Stop Mode</strong>: Full power off. 100% consistent, maximum downtime.</li>
</ol>
<h3 id="section-7-checkpoint">Section 7 Checkpoint</h3>
<p><strong>Summary</strong>:</p>
<ul>
<li><strong>Backup</strong>: Independent Archive, essential for DR.</li>
<li><strong>Modes</strong>: Snapshot - A software-based emulation of a physical computer <span class="glossary-icon"></span> state for rollback <span class="glossary-icon"></span> (Live), Suspend (Frozen), Stop (Consistent).</li>
</ul>
<hr/>
<h2 id="8-managing-storage-via-cli-pvesm">8. Managing Storage via CLI (<code>pvesm</code>)</h2>
<p>Advanced troubleshooting often requires the **Proxmox platform combining KVM - A Hypervisor" class="glossary-term"&gt;Type 1 hypervisor<span class="glossary-tooltip">A bare-metal hypervisor that runs directly on hardware </span><span class="glossary-icon"></span> <span class="glossary-icon"></span> and LXC <span class="glossary-icon"></span> <span class="glossary-icon"></span> VE Storage Manager`.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># 1. Edit the Storage Configuration file</span>
nano<span class="w"> </span>/etc/pve/storage.cfg

<span class="c1"># 2. List all configured storage</span>
pvesm<span class="w"> </span>status

<span class="c1"># 3. Allocating a volume manually</span>
pvesm<span class="w"> </span>alloc<span class="w"> </span>local-lvm<span class="w"> </span><span class="m">100</span><span class="w"> </span>vm-100-disk-1<span class="w"> </span>20G
</code></pre></div>
<h3 id="section-8-checkpoint">Section 8 Checkpoint</h3>
<p><strong>Summary</strong>:</p>
<ul>
<li><code>pvesm</code> helps when the GUI is unavailable.</li>
<li><code>storage.cfg</code> is the cluster-wide storage definition file.</li>
</ul>
<hr/>
<h2 id="9-additional-resources">9. Additional Resources</h2>
<ul>
<li><strong>Cluster Manager Wiki</strong>: <a href="https://pve.proxmox.com/wiki/Cluster_Manager">Proxmox Docs</a></li>
<li><strong>HA - System design for minimal downtime <span class="glossary-icon"></span> Simulator</strong>: <a href="https://pve.proxmox.com/wiki/High_Availability_Cluster#pve_ha_manager_simulator">PVE HA Sim</a></li>
<li><strong>Corosync engine for group communication <span class="glossary-icon"></span> Overview</strong>: <a href="http://clusterlabs.org/corosync.html">ClusterLabs</a></li>
</ul>
<hr/>
<h2 id="10-lab-exercises">10. Lab Exercises</h2>
<ul>
<li><a href="Week_6_Lab_Cluster_and_HA.html">Lab: Cluster &amp; HA</a><ul>
<li><strong>Goal</strong>: Building a Multi-Node Cluster, configuring HA - System design for minimal downtime <span class="glossary-icon"></span>, and Live Migration - A software-based emulation of a physical computer <span class="glossary-icon"></span> between hosts without downtime <span class="glossary-icon"></span>.</li>
</ul>
</li>
</ul>
<p><a href="../index.html">← Back to Course Index</a></p>
<div class="mt-12 p-8 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800 text-center">
<h3 class="text-2xl font-bold text-[var(--text-headings)] mb-4">Test Your Knowledge</h3>
<p class="text-[var(--text-body)] mb-6">Ready to check your understanding of this week's material? Take the interactive quiz now!</p>
<a class="inline-block px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-colors shadow-md no-underline" href="Week_6_Quiz.html" id="start-quiz-btn">
                        Start Quiz
                    </a>
</div>
</article>
</main>
<!-- Footer -->
<footer class="text-center text-slate-500 dark:text-slate-400 text-sm pb-8">
</footer>
<!-- Progress Tracking -->
<script src="../js/course_logic.js"></script>
</body>
</html>
